<h1 id="advanced-rag">Advanced RAG</h1>
<p>Cassandra Maldonado</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="op">!</span>pip install google<span class="op">-</span>auth google<span class="op">-</span>auth<span class="op">-</span>oauthlib google<span class="op">-</span>auth<span class="op">-</span>httplib2 google<span class="op">-</span>api<span class="op">-</span>python<span class="op">-</span>client</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="op">!</span>pip install langchain langchain<span class="op">-</span>community langchain<span class="op">-</span>chroma langchain<span class="op">-</span>openai langchain<span class="op">-</span>core langchain<span class="op">-</span>google<span class="op">-</span>genai langchain<span class="op">-</span>experimental</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="op">!</span>pip install rank_bm25 sentence<span class="op">-</span>transformers pypdf python<span class="op">-</span>dotenv  scikit<span class="op">-</span>learn numpy</span></code></pre></div>
<pre><code>Requirement already satisfied: google-auth in /usr/local/lib/python3.12/dist-packages (2.38.0)
Requirement already satisfied: google-auth-oauthlib in /usr/local/lib/python3.12/dist-packages (1.2.2)
Requirement already satisfied: google-auth-httplib2 in /usr/local/lib/python3.12/dist-packages (0.2.0)
Requirement already satisfied: google-api-python-client in /usr/local/lib/python3.12/dist-packages (2.179.0)
Requirement already satisfied: cachetools&lt;6.0,&gt;=2.0.0 in /usr/local/lib/python3.12/dist-packages (from google-auth) (5.5.2)
Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in /usr/local/lib/python3.12/dist-packages (from google-auth) (0.4.2)
Requirement already satisfied: rsa&lt;5,&gt;=3.1.4 in /usr/local/lib/python3.12/dist-packages (from google-auth) (4.9.1)
Requirement already satisfied: requests-oauthlib&gt;=0.7.0 in /usr/local/lib/python3.12/dist-packages (from google-auth-oauthlib) (2.0.0)
Requirement already satisfied: httplib2&gt;=0.19.0 in /usr/local/lib/python3.12/dist-packages (from google-auth-httplib2) (0.22.0)
Requirement already satisfied: google-api-core!=2.0.*,!=2.1.*,!=2.2.*,!=2.3.0,&lt;3.0.0,&gt;=1.31.5 in /usr/local/lib/python3.12/dist-packages (from google-api-python-client) (2.25.1)
Requirement already satisfied: uritemplate&lt;5,&gt;=3.0.1 in /usr/local/lib/python3.12/dist-packages (from google-api-python-client) (4.2.0)
Requirement already satisfied: googleapis-common-protos&lt;2.0.0,&gt;=1.56.2 in /usr/local/lib/python3.12/dist-packages (from google-api-core!=2.0.*,!=2.1.*,!=2.2.*,!=2.3.0,&lt;3.0.0,&gt;=1.31.5-&gt;google-api-python-client) (1.70.0)
Requirement already satisfied: protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,&lt;7.0.0,&gt;=3.19.5 in /usr/local/lib/python3.12/dist-packages (from google-api-core!=2.0.*,!=2.1.*,!=2.2.*,!=2.3.0,&lt;3.0.0,&gt;=1.31.5-&gt;google-api-python-client) (5.29.5)
Requirement already satisfied: proto-plus&lt;2.0.0,&gt;=1.22.3 in /usr/local/lib/python3.12/dist-packages (from google-api-core!=2.0.*,!=2.1.*,!=2.2.*,!=2.3.0,&lt;3.0.0,&gt;=1.31.5-&gt;google-api-python-client) (1.26.1)
Requirement already satisfied: requests&lt;3.0.0,&gt;=2.18.0 in /usr/local/lib/python3.12/dist-packages (from google-api-core!=2.0.*,!=2.1.*,!=2.2.*,!=2.3.0,&lt;3.0.0,&gt;=1.31.5-&gt;google-api-python-client) (2.32.4)
Requirement already satisfied: pyparsing!=3.0.0,!=3.0.1,!=3.0.2,!=3.0.3,&lt;4,&gt;=2.4.2 in /usr/local/lib/python3.12/dist-packages (from httplib2&gt;=0.19.0-&gt;google-auth-httplib2) (3.2.3)
Requirement already satisfied: pyasn1&lt;0.7.0,&gt;=0.6.1 in /usr/local/lib/python3.12/dist-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth) (0.6.1)
Requirement already satisfied: oauthlib&gt;=3.0.0 in /usr/local/lib/python3.12/dist-packages (from requests-oauthlib&gt;=0.7.0-&gt;google-auth-oauthlib) (3.3.1)
Requirement already satisfied: charset_normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3.0.0,&gt;=2.18.0-&gt;google-api-core!=2.0.*,!=2.1.*,!=2.2.*,!=2.3.0,&lt;3.0.0,&gt;=1.31.5-&gt;google-api-python-client) (3.4.3)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3.0.0,&gt;=2.18.0-&gt;google-api-core!=2.0.*,!=2.1.*,!=2.2.*,!=2.3.0,&lt;3.0.0,&gt;=1.31.5-&gt;google-api-python-client) (3.10)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3.0.0,&gt;=2.18.0-&gt;google-api-core!=2.0.*,!=2.1.*,!=2.2.*,!=2.3.0,&lt;3.0.0,&gt;=1.31.5-&gt;google-api-python-client) (2.5.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3.0.0,&gt;=2.18.0-&gt;google-api-core!=2.0.*,!=2.1.*,!=2.2.*,!=2.3.0,&lt;3.0.0,&gt;=1.31.5-&gt;google-api-python-client) (2025.8.3)
Requirement already satisfied: langchain in /usr/local/lib/python3.12/dist-packages (0.3.27)
Collecting langchain-community
  Downloading langchain_community-0.3.27-py3-none-any.whl.metadata (2.9 kB)
Collecting langchain-chroma
  Downloading langchain_chroma-0.2.5-py3-none-any.whl.metadata (1.1 kB)
Collecting langchain-openai
  Downloading langchain_openai-0.3.30-py3-none-any.whl.metadata (2.4 kB)
Requirement already satisfied: langchain-core in /usr/local/lib/python3.12/dist-packages (0.3.74)
Collecting langchain-google-genai
  Downloading langchain_google_genai-2.1.9-py3-none-any.whl.metadata (7.2 kB)
Collecting langchain-experimental
  Downloading langchain_experimental-0.3.4-py3-none-any.whl.metadata (1.7 kB)
Requirement already satisfied: langchain-text-splitters&lt;1.0.0,&gt;=0.3.9 in /usr/local/lib/python3.12/dist-packages (from langchain) (0.3.9)
Requirement already satisfied: langsmith&gt;=0.1.17 in /usr/local/lib/python3.12/dist-packages (from langchain) (0.4.14)
Requirement already satisfied: pydantic&lt;3.0.0,&gt;=2.7.4 in /usr/local/lib/python3.12/dist-packages (from langchain) (2.11.7)
Requirement already satisfied: SQLAlchemy&lt;3,&gt;=1.4 in /usr/local/lib/python3.12/dist-packages (from langchain) (2.0.43)
Requirement already satisfied: requests&lt;3,&gt;=2 in /usr/local/lib/python3.12/dist-packages (from langchain) (2.32.4)
Requirement already satisfied: PyYAML&gt;=5.3 in /usr/local/lib/python3.12/dist-packages (from langchain) (6.0.2)
Requirement already satisfied: aiohttp&lt;4.0.0,&gt;=3.8.3 in /usr/local/lib/python3.12/dist-packages (from langchain-community) (3.12.15)
Requirement already satisfied: tenacity!=8.4.0,&lt;10,&gt;=8.1.0 in /usr/local/lib/python3.12/dist-packages (from langchain-community) (8.5.0)
Collecting dataclasses-json&lt;0.7,&gt;=0.5.7 (from langchain-community)
  Downloading dataclasses_json-0.6.7-py3-none-any.whl.metadata (25 kB)
Requirement already satisfied: pydantic-settings&lt;3.0.0,&gt;=2.4.0 in /usr/local/lib/python3.12/dist-packages (from langchain-community) (2.10.1)
Requirement already satisfied: httpx-sse&lt;1.0.0,&gt;=0.4.0 in /usr/local/lib/python3.12/dist-packages (from langchain-community) (0.4.1)
Requirement already satisfied: numpy&gt;=1.26.2 in /usr/local/lib/python3.12/dist-packages (from langchain-community) (2.0.2)
Collecting chromadb&gt;=1.0.9 (from langchain-chroma)
  Downloading chromadb-1.0.20-cp39-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (7.3 kB)
Requirement already satisfied: openai&lt;2.0.0,&gt;=1.99.9 in /usr/local/lib/python3.12/dist-packages (from langchain-openai) (1.100.0)
Requirement already satisfied: tiktoken&lt;1,&gt;=0.7 in /usr/local/lib/python3.12/dist-packages (from langchain-openai) (0.11.0)
Requirement already satisfied: jsonpatch&lt;2.0,&gt;=1.33 in /usr/local/lib/python3.12/dist-packages (from langchain-core) (1.33)
Requirement already satisfied: typing-extensions&gt;=4.7 in /usr/local/lib/python3.12/dist-packages (from langchain-core) (4.14.1)
Requirement already satisfied: packaging&gt;=23.2 in /usr/local/lib/python3.12/dist-packages (from langchain-core) (25.0)
Collecting filetype&lt;2.0.0,&gt;=1.2.0 (from langchain-google-genai)
  Downloading filetype-1.2.0-py2.py3-none-any.whl.metadata (6.5 kB)
Collecting google-ai-generativelanguage&lt;0.7.0,&gt;=0.6.18 (from langchain-google-genai)
  Downloading google_ai_generativelanguage-0.6.18-py3-none-any.whl.metadata (9.8 kB)
Requirement already satisfied: aiohappyeyeballs&gt;=2.5.0 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain-community) (2.6.1)
Requirement already satisfied: aiosignal&gt;=1.4.0 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain-community) (1.4.0)
Requirement already satisfied: attrs&gt;=17.3.0 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain-community) (25.3.0)
Requirement already satisfied: frozenlist&gt;=1.1.1 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain-community) (1.7.0)
Requirement already satisfied: multidict&lt;7.0,&gt;=4.5 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain-community) (6.6.4)
Requirement already satisfied: propcache&gt;=0.2.0 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain-community) (0.3.2)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.17.0 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain-community) (1.20.1)
Requirement already satisfied: build&gt;=1.0.3 in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.3.0)
Collecting pybase64&gt;=1.4.1 (from chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading pybase64-1.4.2-cp312-cp312-manylinux1_x86_64.manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_5_x86_64.whl.metadata (8.7 kB)
Requirement already satisfied: uvicorn&gt;=0.18.3 in /usr/local/lib/python3.12/dist-packages (from uvicorn[standard]&gt;=0.18.3-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (0.35.0)
Collecting posthog&lt;6.0.0,&gt;=2.4.0 (from chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading posthog-5.4.0-py3-none-any.whl.metadata (5.7 kB)
Collecting onnxruntime&gt;=1.14.1 (from chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading onnxruntime-1.22.1-cp312-cp312-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl.metadata (4.9 kB)
Requirement already satisfied: opentelemetry-api&gt;=1.2.0 in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.36.0)
Collecting opentelemetry-exporter-otlp-proto-grpc&gt;=1.2.0 (from chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading opentelemetry_exporter_otlp_proto_grpc-1.36.0-py3-none-any.whl.metadata (2.4 kB)
Requirement already satisfied: opentelemetry-sdk&gt;=1.2.0 in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.36.0)
Requirement already satisfied: tokenizers&gt;=0.13.2 in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (0.21.4)
Collecting pypika&gt;=0.48.9 (from chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading PyPika-0.48.9.tar.gz (67 kB)
[2K     [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m67.3/67.3 kB[0m [31m3.1 MB/s[0m eta [36m0:00:00[0m
[?25h  Installing build dependencies ... [?25l[?25hdone
  Getting requirements to build wheel ... [?25l[?25hdone
  Preparing metadata (pyproject.toml) ... [?25l[?25hdone
Requirement already satisfied: tqdm&gt;=4.65.0 in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (4.67.1)
Collecting overrides&gt;=7.3.1 (from chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading overrides-7.7.0-py3-none-any.whl.metadata (5.8 kB)
Requirement already satisfied: importlib-resources in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (6.5.2)
Requirement already satisfied: grpcio&gt;=1.58.0 in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.74.0)
Collecting bcrypt&gt;=4.0.1 (from chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading bcrypt-4.3.0-cp39-abi3-manylinux_2_34_x86_64.whl.metadata (10 kB)
Requirement already satisfied: typer&gt;=0.9.0 in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (0.16.0)
Collecting kubernetes&gt;=28.1.0 (from chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading kubernetes-33.1.0-py2.py3-none-any.whl.metadata (1.7 kB)
Collecting mmh3&gt;=4.0.1 (from chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading mmh3-5.2.0-cp312-cp312-manylinux1_x86_64.manylinux_2_28_x86_64.manylinux_2_5_x86_64.whl.metadata (14 kB)
Requirement already satisfied: orjson&gt;=3.9.12 in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (3.11.2)
Requirement already satisfied: httpx&gt;=0.27.0 in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (0.28.1)
Requirement already satisfied: rich&gt;=10.11.0 in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (13.9.4)
Requirement already satisfied: jsonschema&gt;=4.19.0 in /usr/local/lib/python3.12/dist-packages (from chromadb&gt;=1.0.9-&gt;langchain-chroma) (4.25.1)
Collecting marshmallow&lt;4.0.0,&gt;=3.18.0 (from dataclasses-json&lt;0.7,&gt;=0.5.7-&gt;langchain-community)
  Downloading marshmallow-3.26.1-py3-none-any.whl.metadata (7.3 kB)
Collecting typing-inspect&lt;1,&gt;=0.4.0 (from dataclasses-json&lt;0.7,&gt;=0.5.7-&gt;langchain-community)
  Downloading typing_inspect-0.9.0-py3-none-any.whl.metadata (1.5 kB)
Requirement already satisfied: google-api-core!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,&lt;3.0.0,&gt;=1.34.1 in /usr/local/lib/python3.12/dist-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,&lt;3.0.0,&gt;=1.34.1-&gt;google-ai-generativelanguage&lt;0.7.0,&gt;=0.6.18-&gt;langchain-google-genai) (2.25.1)
Requirement already satisfied: google-auth!=2.24.0,!=2.25.0,&lt;3.0.0,&gt;=2.14.1 in /usr/local/lib/python3.12/dist-packages (from google-ai-generativelanguage&lt;0.7.0,&gt;=0.6.18-&gt;langchain-google-genai) (2.38.0)
Requirement already satisfied: proto-plus&lt;2.0.0,&gt;=1.22.3 in /usr/local/lib/python3.12/dist-packages (from google-ai-generativelanguage&lt;0.7.0,&gt;=0.6.18-&gt;langchain-google-genai) (1.26.1)
Requirement already satisfied: protobuf!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,&lt;7.0.0,&gt;=3.20.2 in /usr/local/lib/python3.12/dist-packages (from google-ai-generativelanguage&lt;0.7.0,&gt;=0.6.18-&gt;langchain-google-genai) (5.29.5)
Requirement already satisfied: jsonpointer&gt;=1.9 in /usr/local/lib/python3.12/dist-packages (from jsonpatch&lt;2.0,&gt;=1.33-&gt;langchain-core) (3.0.0)
Requirement already satisfied: requests-toolbelt&gt;=1.0.0 in /usr/local/lib/python3.12/dist-packages (from langsmith&gt;=0.1.17-&gt;langchain) (1.0.0)
Requirement already satisfied: zstandard&gt;=0.23.0 in /usr/local/lib/python3.12/dist-packages (from langsmith&gt;=0.1.17-&gt;langchain) (0.24.0)
Requirement already satisfied: anyio&lt;5,&gt;=3.5.0 in /usr/local/lib/python3.12/dist-packages (from openai&lt;2.0.0,&gt;=1.99.9-&gt;langchain-openai) (4.10.0)
Requirement already satisfied: distro&lt;2,&gt;=1.7.0 in /usr/local/lib/python3.12/dist-packages (from openai&lt;2.0.0,&gt;=1.99.9-&gt;langchain-openai) (1.9.0)
Requirement already satisfied: jiter&lt;1,&gt;=0.4.0 in /usr/local/lib/python3.12/dist-packages (from openai&lt;2.0.0,&gt;=1.99.9-&gt;langchain-openai) (0.10.0)
Requirement already satisfied: sniffio in /usr/local/lib/python3.12/dist-packages (from openai&lt;2.0.0,&gt;=1.99.9-&gt;langchain-openai) (1.3.1)
Requirement already satisfied: annotated-types&gt;=0.6.0 in /usr/local/lib/python3.12/dist-packages (from pydantic&lt;3.0.0,&gt;=2.7.4-&gt;langchain) (0.7.0)
Requirement already satisfied: pydantic-core==2.33.2 in /usr/local/lib/python3.12/dist-packages (from pydantic&lt;3.0.0,&gt;=2.7.4-&gt;langchain) (2.33.2)
Requirement already satisfied: typing-inspection&gt;=0.4.0 in /usr/local/lib/python3.12/dist-packages (from pydantic&lt;3.0.0,&gt;=2.7.4-&gt;langchain) (0.4.1)
Requirement already satisfied: python-dotenv&gt;=0.21.0 in /usr/local/lib/python3.12/dist-packages (from pydantic-settings&lt;3.0.0,&gt;=2.4.0-&gt;langchain-community) (1.1.1)
Requirement already satisfied: charset_normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3,&gt;=2-&gt;langchain) (3.4.3)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3,&gt;=2-&gt;langchain) (3.10)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3,&gt;=2-&gt;langchain) (2.5.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3,&gt;=2-&gt;langchain) (2025.8.3)
Requirement already satisfied: greenlet&gt;=1 in /usr/local/lib/python3.12/dist-packages (from SQLAlchemy&lt;3,&gt;=1.4-&gt;langchain) (3.2.4)
Requirement already satisfied: regex&gt;=2022.1.18 in /usr/local/lib/python3.12/dist-packages (from tiktoken&lt;1,&gt;=0.7-&gt;langchain-openai) (2024.11.6)
Requirement already satisfied: pyproject_hooks in /usr/local/lib/python3.12/dist-packages (from build&gt;=1.0.3-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.2.0)
Requirement already satisfied: googleapis-common-protos&lt;2.0.0,&gt;=1.56.2 in /usr/local/lib/python3.12/dist-packages (from google-api-core!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,&lt;3.0.0,&gt;=1.34.1-&gt;google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,&lt;3.0.0,&gt;=1.34.1-&gt;google-ai-generativelanguage&lt;0.7.0,&gt;=0.6.18-&gt;langchain-google-genai) (1.70.0)
Requirement already satisfied: grpcio-status&lt;2.0.0,&gt;=1.33.2 in /usr/local/lib/python3.12/dist-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,&lt;3.0.0,&gt;=1.34.1-&gt;google-ai-generativelanguage&lt;0.7.0,&gt;=0.6.18-&gt;langchain-google-genai) (1.71.2)
Requirement already satisfied: cachetools&lt;6.0,&gt;=2.0.0 in /usr/local/lib/python3.12/dist-packages (from google-auth!=2.24.0,!=2.25.0,&lt;3.0.0,&gt;=2.14.1-&gt;google-ai-generativelanguage&lt;0.7.0,&gt;=0.6.18-&gt;langchain-google-genai) (5.5.2)
Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in /usr/local/lib/python3.12/dist-packages (from google-auth!=2.24.0,!=2.25.0,&lt;3.0.0,&gt;=2.14.1-&gt;google-ai-generativelanguage&lt;0.7.0,&gt;=0.6.18-&gt;langchain-google-genai) (0.4.2)
Requirement already satisfied: rsa&lt;5,&gt;=3.1.4 in /usr/local/lib/python3.12/dist-packages (from google-auth!=2.24.0,!=2.25.0,&lt;3.0.0,&gt;=2.14.1-&gt;google-ai-generativelanguage&lt;0.7.0,&gt;=0.6.18-&gt;langchain-google-genai) (4.9.1)
Requirement already satisfied: httpcore==1.* in /usr/local/lib/python3.12/dist-packages (from httpx&gt;=0.27.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.0.9)
Requirement already satisfied: h11&gt;=0.16 in /usr/local/lib/python3.12/dist-packages (from httpcore==1.*-&gt;httpx&gt;=0.27.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (0.16.0)
Requirement already satisfied: jsonschema-specifications&gt;=2023.03.6 in /usr/local/lib/python3.12/dist-packages (from jsonschema&gt;=4.19.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (2025.4.1)
Requirement already satisfied: referencing&gt;=0.28.4 in /usr/local/lib/python3.12/dist-packages (from jsonschema&gt;=4.19.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (0.36.2)
Requirement already satisfied: rpds-py&gt;=0.7.1 in /usr/local/lib/python3.12/dist-packages (from jsonschema&gt;=4.19.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (0.27.0)
Requirement already satisfied: six&gt;=1.9.0 in /usr/local/lib/python3.12/dist-packages (from kubernetes&gt;=28.1.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.17.0)
Requirement already satisfied: python-dateutil&gt;=2.5.3 in /usr/local/lib/python3.12/dist-packages (from kubernetes&gt;=28.1.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (2.9.0.post0)
Requirement already satisfied: websocket-client!=0.40.0,!=0.41.*,!=0.42.*,&gt;=0.32.0 in /usr/local/lib/python3.12/dist-packages (from kubernetes&gt;=28.1.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.8.0)
Requirement already satisfied: requests-oauthlib in /usr/local/lib/python3.12/dist-packages (from kubernetes&gt;=28.1.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (2.0.0)
Requirement already satisfied: oauthlib&gt;=3.2.2 in /usr/local/lib/python3.12/dist-packages (from kubernetes&gt;=28.1.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (3.3.1)
Collecting durationpy&gt;=0.7 (from kubernetes&gt;=28.1.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading durationpy-0.10-py3-none-any.whl.metadata (340 bytes)
Collecting coloredlogs (from onnxruntime&gt;=1.14.1-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading coloredlogs-15.0.1-py2.py3-none-any.whl.metadata (12 kB)
Requirement already satisfied: flatbuffers in /usr/local/lib/python3.12/dist-packages (from onnxruntime&gt;=1.14.1-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (25.2.10)
Requirement already satisfied: sympy in /usr/local/lib/python3.12/dist-packages (from onnxruntime&gt;=1.14.1-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.13.3)
Requirement already satisfied: importlib-metadata&lt;8.8.0,&gt;=6.0 in /usr/local/lib/python3.12/dist-packages (from opentelemetry-api&gt;=1.2.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (8.7.0)
Collecting opentelemetry-exporter-otlp-proto-common==1.36.0 (from opentelemetry-exporter-otlp-proto-grpc&gt;=1.2.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading opentelemetry_exporter_otlp_proto_common-1.36.0-py3-none-any.whl.metadata (1.8 kB)
Collecting opentelemetry-proto==1.36.0 (from opentelemetry-exporter-otlp-proto-grpc&gt;=1.2.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading opentelemetry_proto-1.36.0-py3-none-any.whl.metadata (2.3 kB)
Requirement already satisfied: opentelemetry-semantic-conventions==0.57b0 in /usr/local/lib/python3.12/dist-packages (from opentelemetry-sdk&gt;=1.2.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (0.57b0)
Collecting backoff&gt;=1.10.0 (from posthog&lt;6.0.0,&gt;=2.4.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading backoff-2.2.1-py3-none-any.whl.metadata (14 kB)
Requirement already satisfied: markdown-it-py&gt;=2.2.0 in /usr/local/lib/python3.12/dist-packages (from rich&gt;=10.11.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (4.0.0)
Requirement already satisfied: pygments&lt;3.0.0,&gt;=2.13.0 in /usr/local/lib/python3.12/dist-packages (from rich&gt;=10.11.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (2.19.2)
Requirement already satisfied: huggingface-hub&lt;1.0,&gt;=0.16.4 in /usr/local/lib/python3.12/dist-packages (from tokenizers&gt;=0.13.2-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (0.34.4)
Requirement already satisfied: click&gt;=8.0.0 in /usr/local/lib/python3.12/dist-packages (from typer&gt;=0.9.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (8.2.1)
Requirement already satisfied: shellingham&gt;=1.3.0 in /usr/local/lib/python3.12/dist-packages (from typer&gt;=0.9.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.5.4)
Collecting mypy-extensions&gt;=0.3.0 (from typing-inspect&lt;1,&gt;=0.4.0-&gt;dataclasses-json&lt;0.7,&gt;=0.5.7-&gt;langchain-community)
  Downloading mypy_extensions-1.1.0-py3-none-any.whl.metadata (1.1 kB)
Collecting httptools&gt;=0.6.3 (from uvicorn[standard]&gt;=0.18.3-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading httptools-0.6.4-cp312-cp312-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.6 kB)
Collecting uvloop&gt;=0.15.1 (from uvicorn[standard]&gt;=0.18.3-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading uvloop-0.21.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (4.9 kB)
Collecting watchfiles&gt;=0.13 (from uvicorn[standard]&gt;=0.18.3-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading watchfiles-1.1.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (4.9 kB)
Requirement already satisfied: websockets&gt;=10.4 in /usr/local/lib/python3.12/dist-packages (from uvicorn[standard]&gt;=0.18.3-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (15.0.1)
Requirement already satisfied: filelock in /usr/local/lib/python3.12/dist-packages (from huggingface-hub&lt;1.0,&gt;=0.16.4-&gt;tokenizers&gt;=0.13.2-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (3.19.1)
Requirement already satisfied: fsspec&gt;=2023.5.0 in /usr/local/lib/python3.12/dist-packages (from huggingface-hub&lt;1.0,&gt;=0.16.4-&gt;tokenizers&gt;=0.13.2-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (2025.3.0)
Requirement already satisfied: hf-xet&lt;2.0.0,&gt;=1.1.3 in /usr/local/lib/python3.12/dist-packages (from huggingface-hub&lt;1.0,&gt;=0.16.4-&gt;tokenizers&gt;=0.13.2-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.1.7)
Requirement already satisfied: zipp&gt;=3.20 in /usr/local/lib/python3.12/dist-packages (from importlib-metadata&lt;8.8.0,&gt;=6.0-&gt;opentelemetry-api&gt;=1.2.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (3.23.0)
Requirement already satisfied: mdurl~=0.1 in /usr/local/lib/python3.12/dist-packages (from markdown-it-py&gt;=2.2.0-&gt;rich&gt;=10.11.0-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (0.1.2)
Requirement already satisfied: pyasn1&lt;0.7.0,&gt;=0.6.1 in /usr/local/lib/python3.12/dist-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth!=2.24.0,!=2.25.0,&lt;3.0.0,&gt;=2.14.1-&gt;google-ai-generativelanguage&lt;0.7.0,&gt;=0.6.18-&gt;langchain-google-genai) (0.6.1)
Collecting humanfriendly&gt;=9.1 (from coloredlogs-&gt;onnxruntime&gt;=1.14.1-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma)
  Downloading humanfriendly-10.0-py2.py3-none-any.whl.metadata (9.2 kB)
Requirement already satisfied: mpmath&lt;1.4,&gt;=1.1.0 in /usr/local/lib/python3.12/dist-packages (from sympy-&gt;onnxruntime&gt;=1.14.1-&gt;chromadb&gt;=1.0.9-&gt;langchain-chroma) (1.3.0)
Downloading langchain_community-0.3.27-py3-none-any.whl (2.5 MB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m2.5/2.5 MB[0m [31m21.5 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading langchain_chroma-0.2.5-py3-none-any.whl (12 kB)
Downloading langchain_openai-0.3.30-py3-none-any.whl (74 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m74.4/74.4 kB[0m [31m3.7 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading langchain_google_genai-2.1.9-py3-none-any.whl (49 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m49.4/49.4 kB[0m [31m2.7 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading langchain_experimental-0.3.4-py3-none-any.whl (209 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m209.2/209.2 kB[0m [31m6.9 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading chromadb-1.0.20-cp39-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (19.8 MB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m19.8/19.8 MB[0m [31m35.1 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading dataclasses_json-0.6.7-py3-none-any.whl (28 kB)
Downloading filetype-1.2.0-py2.py3-none-any.whl (19 kB)
Downloading google_ai_generativelanguage-0.6.18-py3-none-any.whl (1.4 MB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m1.4/1.4 MB[0m [31m23.5 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading bcrypt-4.3.0-cp39-abi3-manylinux_2_34_x86_64.whl (284 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m284.2/284.2 kB[0m [31m8.6 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading kubernetes-33.1.0-py2.py3-none-any.whl (1.9 MB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m1.9/1.9 MB[0m [31m26.7 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading marshmallow-3.26.1-py3-none-any.whl (50 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m50.9/50.9 kB[0m [31m2.0 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading mmh3-5.2.0-cp312-cp312-manylinux1_x86_64.manylinux_2_28_x86_64.manylinux_2_5_x86_64.whl (103 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m103.3/103.3 kB[0m [31m5.8 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading onnxruntime-1.22.1-cp312-cp312-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl (16.5 MB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m16.5/16.5 MB[0m [31m24.7 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading opentelemetry_exporter_otlp_proto_grpc-1.36.0-py3-none-any.whl (18 kB)
Downloading opentelemetry_exporter_otlp_proto_common-1.36.0-py3-none-any.whl (18 kB)
Downloading opentelemetry_proto-1.36.0-py3-none-any.whl (72 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m72.5/72.5 kB[0m [31m4.0 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading overrides-7.7.0-py3-none-any.whl (17 kB)
Downloading posthog-5.4.0-py3-none-any.whl (105 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m105.4/105.4 kB[0m [31m8.5 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading pybase64-1.4.2-cp312-cp312-manylinux1_x86_64.manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_5_x86_64.whl (71 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m71.6/71.6 kB[0m [31m5.8 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading typing_inspect-0.9.0-py3-none-any.whl (8.8 kB)
Downloading backoff-2.2.1-py3-none-any.whl (15 kB)
Downloading durationpy-0.10-py3-none-any.whl (3.9 kB)
Downloading httptools-0.6.4-cp312-cp312-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (510 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m510.8/510.8 kB[0m [31m29.4 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading mypy_extensions-1.1.0-py3-none-any.whl (5.0 kB)
Downloading uvloop-0.21.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (4.7 MB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m4.7/4.7 MB[0m [31m52.7 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading watchfiles-1.1.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (452 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m452.2/452.2 kB[0m [31m26.4 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading coloredlogs-15.0.1-py2.py3-none-any.whl (46 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m46.0/46.0 kB[0m [31m2.6 MB/s[0m eta [36m0:00:00[0m
[?25hDownloading humanfriendly-10.0-py2.py3-none-any.whl (86 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m86.8/86.8 kB[0m [31m6.2 MB/s[0m eta [36m0:00:00[0m
[?25hBuilding wheels for collected packages: pypika
  Building wheel for pypika (pyproject.toml) ... [?25l[?25hdone
  Created wheel for pypika: filename=pypika-0.48.9-py2.py3-none-any.whl size=53803 sha256=a17b87d45c8b17b2eac9eb9b92359f5b2233bbe253ddfcf6e676cda8fc552af4
  Stored in directory: /root/.cache/pip/wheels/d5/3d/69/8d68d249cd3de2584f226e27fd431d6344f7d70fd856ebd01b
Successfully built pypika
Installing collected packages: pypika, filetype, durationpy, uvloop, pybase64, overrides, opentelemetry-proto, mypy-extensions, mmh3, marshmallow, humanfriendly, httptools, bcrypt, backoff, watchfiles, typing-inspect, posthog, opentelemetry-exporter-otlp-proto-common, coloredlogs, onnxruntime, kubernetes, dataclasses-json, opentelemetry-exporter-otlp-proto-grpc, langchain-openai, google-ai-generativelanguage, langchain-google-genai, chromadb, langchain-community, langchain-chroma, langchain-experimental
  Attempting uninstall: google-ai-generativelanguage
    Found existing installation: google-ai-generativelanguage 0.6.15
    Uninstalling google-ai-generativelanguage-0.6.15:
      Successfully uninstalled google-ai-generativelanguage-0.6.15
[31mERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
google-generativeai 0.8.5 requires google-ai-generativelanguage==0.6.15, but you have google-ai-generativelanguage 0.6.18 which is incompatible.[0m[31m
[0mSuccessfully installed backoff-2.2.1 bcrypt-4.3.0 chromadb-1.0.20 coloredlogs-15.0.1 dataclasses-json-0.6.7 durationpy-0.10 filetype-1.2.0 google-ai-generativelanguage-0.6.18 httptools-0.6.4 humanfriendly-10.0 kubernetes-33.1.0 langchain-chroma-0.2.5 langchain-community-0.3.27 langchain-experimental-0.3.4 langchain-google-genai-2.1.9 langchain-openai-0.3.30 marshmallow-3.26.1 mmh3-5.2.0 mypy-extensions-1.1.0 onnxruntime-1.22.1 opentelemetry-exporter-otlp-proto-common-1.36.0 opentelemetry-exporter-otlp-proto-grpc-1.36.0 opentelemetry-proto-1.36.0 overrides-7.7.0 posthog-5.4.0 pybase64-1.4.2 pypika-0.48.9 typing-inspect-0.9.0 uvloop-0.21.0 watchfiles-1.1.0




Collecting rank_bm25
  Downloading rank_bm25-0.2.2-py3-none-any.whl.metadata (3.2 kB)
Requirement already satisfied: sentence-transformers in /usr/local/lib/python3.12/dist-packages (5.1.0)
Collecting pypdf
  Downloading pypdf-6.0.0-py3-none-any.whl.metadata (7.1 kB)
Requirement already satisfied: python-dotenv in /usr/local/lib/python3.12/dist-packages (1.1.1)
Requirement already satisfied: scikit-learn in /usr/local/lib/python3.12/dist-packages (1.6.1)
Requirement already satisfied: numpy in /usr/local/lib/python3.12/dist-packages (2.0.2)
Requirement already satisfied: transformers&lt;5.0.0,&gt;=4.41.0 in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (4.55.2)
Requirement already satisfied: tqdm in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (4.67.1)
Requirement already satisfied: torch&gt;=1.11.0 in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (2.8.0+cu126)
Requirement already satisfied: scipy in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (1.16.1)
Requirement already satisfied: huggingface-hub&gt;=0.20.0 in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (0.34.4)
Requirement already satisfied: Pillow in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (11.3.0)
Requirement already satisfied: typing_extensions&gt;=4.5.0 in /usr/local/lib/python3.12/dist-packages (from sentence-transformers) (4.14.1)
Requirement already satisfied: joblib&gt;=1.2.0 in /usr/local/lib/python3.12/dist-packages (from scikit-learn) (1.5.1)
Requirement already satisfied: threadpoolctl&gt;=3.1.0 in /usr/local/lib/python3.12/dist-packages (from scikit-learn) (3.6.0)
Requirement already satisfied: filelock in /usr/local/lib/python3.12/dist-packages (from huggingface-hub&gt;=0.20.0-&gt;sentence-transformers) (3.19.1)
Requirement already satisfied: fsspec&gt;=2023.5.0 in /usr/local/lib/python3.12/dist-packages (from huggingface-hub&gt;=0.20.0-&gt;sentence-transformers) (2025.3.0)
Requirement already satisfied: packaging&gt;=20.9 in /usr/local/lib/python3.12/dist-packages (from huggingface-hub&gt;=0.20.0-&gt;sentence-transformers) (25.0)
Requirement already satisfied: pyyaml&gt;=5.1 in /usr/local/lib/python3.12/dist-packages (from huggingface-hub&gt;=0.20.0-&gt;sentence-transformers) (6.0.2)
Requirement already satisfied: requests in /usr/local/lib/python3.12/dist-packages (from huggingface-hub&gt;=0.20.0-&gt;sentence-transformers) (2.32.4)
Requirement already satisfied: hf-xet&lt;2.0.0,&gt;=1.1.3 in /usr/local/lib/python3.12/dist-packages (from huggingface-hub&gt;=0.20.0-&gt;sentence-transformers) (1.1.7)
Requirement already satisfied: setuptools in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (75.2.0)
Requirement already satisfied: sympy&gt;=1.13.3 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (1.13.3)
Requirement already satisfied: networkx in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (3.5)
Requirement already satisfied: jinja2 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (3.1.6)
Requirement already satisfied: nvidia-cuda-nvrtc-cu12==12.6.77 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (12.6.77)
Requirement already satisfied: nvidia-cuda-runtime-cu12==12.6.77 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (12.6.77)
Requirement already satisfied: nvidia-cuda-cupti-cu12==12.6.80 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (12.6.80)
Requirement already satisfied: nvidia-cudnn-cu12==9.10.2.21 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (9.10.2.21)
Requirement already satisfied: nvidia-cublas-cu12==12.6.4.1 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (12.6.4.1)
Requirement already satisfied: nvidia-cufft-cu12==11.3.0.4 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (11.3.0.4)
Requirement already satisfied: nvidia-curand-cu12==10.3.7.77 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (10.3.7.77)
Requirement already satisfied: nvidia-cusolver-cu12==11.7.1.2 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (11.7.1.2)
Requirement already satisfied: nvidia-cusparse-cu12==12.5.4.2 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (12.5.4.2)
Requirement already satisfied: nvidia-cusparselt-cu12==0.7.1 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (0.7.1)
Requirement already satisfied: nvidia-nccl-cu12==2.27.3 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (2.27.3)
Requirement already satisfied: nvidia-nvtx-cu12==12.6.77 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (12.6.77)
Requirement already satisfied: nvidia-nvjitlink-cu12==12.6.85 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (12.6.85)
Requirement already satisfied: nvidia-cufile-cu12==1.11.1.6 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (1.11.1.6)
Requirement already satisfied: triton==3.4.0 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=1.11.0-&gt;sentence-transformers) (3.4.0)
Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.12/dist-packages (from transformers&lt;5.0.0,&gt;=4.41.0-&gt;sentence-transformers) (2024.11.6)
Requirement already satisfied: tokenizers&lt;0.22,&gt;=0.21 in /usr/local/lib/python3.12/dist-packages (from transformers&lt;5.0.0,&gt;=4.41.0-&gt;sentence-transformers) (0.21.4)
Requirement already satisfied: safetensors&gt;=0.4.3 in /usr/local/lib/python3.12/dist-packages (from transformers&lt;5.0.0,&gt;=4.41.0-&gt;sentence-transformers) (0.6.2)
Requirement already satisfied: mpmath&lt;1.4,&gt;=1.1.0 in /usr/local/lib/python3.12/dist-packages (from sympy&gt;=1.13.3-&gt;torch&gt;=1.11.0-&gt;sentence-transformers) (1.3.0)
Requirement already satisfied: MarkupSafe&gt;=2.0 in /usr/local/lib/python3.12/dist-packages (from jinja2-&gt;torch&gt;=1.11.0-&gt;sentence-transformers) (3.0.2)
Requirement already satisfied: charset_normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.12/dist-packages (from requests-&gt;huggingface-hub&gt;=0.20.0-&gt;sentence-transformers) (3.4.3)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.12/dist-packages (from requests-&gt;huggingface-hub&gt;=0.20.0-&gt;sentence-transformers) (3.10)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.12/dist-packages (from requests-&gt;huggingface-hub&gt;=0.20.0-&gt;sentence-transformers) (2.5.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.12/dist-packages (from requests-&gt;huggingface-hub&gt;=0.20.0-&gt;sentence-transformers) (2025.8.3)
Downloading rank_bm25-0.2.2-py3-none-any.whl (8.6 kB)
Downloading pypdf-6.0.0-py3-none-any.whl (310 kB)
[2K   [90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m [32m310.5/310.5 kB[0m [31m11.2 MB/s[0m eta [36m0:00:00[0m
[?25hInstalling collected packages: rank_bm25, pypdf
Successfully installed pypdf-6.0.0 rank_bm25-0.2.2</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="im">import</span> glob</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Optional</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="im">import</span> logging</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="im">import</span> time</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="im">from</span> langchain_community.document_loaders <span class="im">import</span> PyPDFLoader</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a><span class="im">from</span> langchain.text_splitter <span class="im">import</span> RecursiveCharacterTextSplitter</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="im">from</span> langchain <span class="im">import</span> hub</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a><span class="im">from</span> langchain_core.runnables <span class="im">import</span> RunnablePassthrough, RunnableParallel</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a><span class="im">from</span> langchain_core.output_parsers <span class="im">import</span> StrOutputParser</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a><span class="im">from</span> langchain_core.prompts <span class="im">import</span> ChatPromptTemplate</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a><span class="im">from</span> langchain_chroma <span class="im">import</span> Chroma</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a><span class="im">from</span> langchain_openai <span class="im">import</span> OpenAIEmbeddings, ChatOpenAI</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a><span class="im">from</span> langchain.chat_models <span class="im">import</span> init_chat_model</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a><span class="im">from</span> langchain_google_genai <span class="im">import</span> GoogleGenerativeAIEmbeddings</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a><span class="im">import</span> getpass</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a><span class="im">import</span> torch</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a><span class="im">from</span> sentence_transformers <span class="im">import</span> SentenceTransformer</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a><span class="im">from</span> langchain_community.embeddings <span class="im">import</span> HuggingFaceEmbeddings</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>DEFAULT_MODEL_PROVIDER <span class="op">=</span> <span class="st">&quot;google_genai&quot;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>DEFAULT_MODEL_NAME <span class="op">=</span> <span class="st">&quot;gemini-2.5-flash&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>DEFAULT_TEMPERATURE <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>DEFAULT_CHUNK_SIZE <span class="op">=</span> <span class="dv">2000</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>DEFAULT_CHUNK_OVERLAP <span class="op">=</span> <span class="dv">400</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>DEFAULT_RETRIEVAL_K <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>logging.basicConfig(level<span class="op">=</span>logging.INFO, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">&#39;</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">class</span> AcademicRAG:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>    SUPPORTED_PROVIDERS <span class="op">=</span> [<span class="st">&quot;openai&quot;</span>, <span class="st">&quot;google_genai&quot;</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    PROVIDER_ENV_VARS <span class="op">=</span> {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>        <span class="st">&quot;openai&quot;</span>: <span class="st">&quot;OPENAI_API_KEY&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>        <span class="st">&quot;google_genai&quot;</span>: <span class="st">&quot;GOOGLE_API_KEY&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>    }</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, model_name: <span class="bu">str</span> <span class="op">=</span> DEFAULT_MODEL_NAME, model_provider: <span class="bu">str</span> <span class="op">=</span> DEFAULT_MODEL_PROVIDER, temperature: <span class="bu">float</span> <span class="op">=</span> DEFAULT_TEMPERATURE, use_fine_tuned: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>, fine_tuned_model_path: <span class="bu">str</span> <span class="op">=</span> <span class="st">&quot;/content/drive/MyDrive/fine_tuned_model_ragqa&quot;</span>):</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>        <span class="cf">if</span> model_provider <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>.SUPPORTED_PROVIDERS:</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f&quot;Unsupported model provider: </span><span class="sc">{</span>model_provider<span class="sc">}</span><span class="ss">. Supported providers: </span><span class="sc">{</span><span class="st">&#39;, &#39;</span><span class="sc">.</span>join(<span class="va">self</span>.SUPPORTED_PROVIDERS)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>        <span class="va">self</span>.model_name <span class="op">=</span> model_name</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>        <span class="va">self</span>.temperature <span class="op">=</span> temperature</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>        <span class="va">self</span>.model_provider <span class="op">=</span> model_provider</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>        <span class="va">self</span>.use_fine_tuned <span class="op">=</span> use_fine_tuned</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>        <span class="va">self</span>.fine_tuned_model_path <span class="op">=</span> fine_tuned_model_path</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a>        <span class="va">self</span>.vectorstore <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>        <span class="va">self</span>.retriever <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>        <span class="va">self</span>.rag_chain <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a>        <span class="va">self</span>.rag_folder <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a>        <span class="va">self</span>.documents <span class="op">=</span> []</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true"></a>        <span class="va">self</span>.chunk_size <span class="op">=</span> DEFAULT_CHUNK_SIZE</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true"></a>        <span class="va">self</span>.chunk_overlap <span class="op">=</span> DEFAULT_CHUNK_OVERLAP</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true"></a>        <span class="va">self</span>.retrieval_k <span class="op">=</span> DEFAULT_RETRIEVAL_K</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true"></a>        <span class="va">self</span>.embeddings_model <span class="op">=</span> <span class="va">None</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true"></a>    <span class="at">@staticmethod</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true"></a>    <span class="kw">def</span> get_api_key_for_provider(provider: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> provider:</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;ERROR: Provider cannot be empty.&quot;</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true"></a>        provider <span class="op">=</span> provider.lower()</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true"></a>        <span class="cf">if</span> provider <span class="kw">not</span> <span class="kw">in</span> AcademicRAG.SUPPORTED_PROVIDERS:</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="ss">f&quot;ERROR: Unknown model provider &#39;</span><span class="sc">{</span>provider<span class="sc">}</span><span class="ss">&#39;. Supported providers: </span><span class="sc">{</span><span class="st">&#39;, &#39;</span><span class="sc">.</span>join(AcademicRAG.SUPPORTED_PROVIDERS)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true"></a>        env_var <span class="op">=</span> AcademicRAG.PROVIDER_ENV_VARS[provider]</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true"></a>        key <span class="op">=</span> os.getenv(env_var)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> key:</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true"></a>            <span class="cf">if</span> provider <span class="op">==</span> <span class="st">&quot;openai&quot;</span>:</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true"></a>                key <span class="op">=</span> getpass.getpass(<span class="st">&quot;Enter your OpenAI API key: &quot;</span>)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true"></a>            <span class="cf">elif</span> provider <span class="op">==</span> <span class="st">&quot;google_genai&quot;</span>:</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true"></a>                key <span class="op">=</span> getpass.getpass(<span class="st">&quot;Enter your Google API key: &quot;</span>)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true"></a>        <span class="cf">if</span> provider <span class="op">==</span> <span class="st">&quot;openai&quot;</span>:</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true"></a>            <span class="cf">if</span> <span class="kw">not</span> key <span class="kw">or</span> <span class="bu">len</span>(key) <span class="op">&lt;</span> <span class="dv">20</span> <span class="kw">or</span> <span class="kw">not</span> key.startswith(<span class="st">&#39;sk-&#39;</span>):</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="st">&quot;Error: Invalid OpenAI API key.&quot;</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Please set </span><span class="sc">{</span>env_var<span class="sc">}</span><span class="ss"> environment variable or enter it when prompted.&quot;</span>)</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true"></a>                <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true"></a>        <span class="cf">elif</span> provider <span class="op">==</span> <span class="st">&quot;google_genai&quot;</span>:</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true"></a>            <span class="cf">if</span> <span class="kw">not</span> key <span class="kw">or</span> <span class="bu">len</span>(key) <span class="op">&lt;</span> <span class="dv">20</span>:</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="st">&quot;Error: Invalid Google API key.&quot;</span>)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Please set </span><span class="sc">{</span>env_var<span class="sc">}</span><span class="ss"> environment variable or enter it when prompted.&quot;</span>)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true"></a>                <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true"></a></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true"></a>        os.environ[env_var] <span class="op">=</span> key</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>provider<span class="sc">.</span>title()<span class="sc">}</span><span class="ss"> API key set in environment (length: </span><span class="sc">{</span><span class="bu">len</span>(key)<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true"></a></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true"></a>    <span class="at">@staticmethod</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true"></a>    <span class="kw">def</span> verify_environment_setup(provider: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> provider:</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;Error: Provider cannot be empty.&quot;</span>)</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true"></a></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true"></a>        provider <span class="op">=</span> provider.lower()</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true"></a></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true"></a>        <span class="cf">if</span> provider <span class="kw">not</span> <span class="kw">in</span> AcademicRAG.SUPPORTED_PROVIDERS:</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="ss">f&quot;X Unknown provider &#39;</span><span class="sc">{</span>provider<span class="sc">}</span><span class="ss">&#39;. Supported providers: </span><span class="sc">{</span><span class="st">&#39;, &#39;</span><span class="sc">.</span>join(AcademicRAG.SUPPORTED_PROVIDERS)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true"></a></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true"></a>        env_var <span class="op">=</span> AcademicRAG.PROVIDER_ENV_VARS[provider]</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true"></a>        key <span class="op">=</span> os.getenv(env_var)</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true"></a></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true"></a>        <span class="cf">if</span> provider <span class="op">==</span> <span class="st">&quot;openai&quot;</span>:</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true"></a>            <span class="cf">if</span> key <span class="kw">and</span> <span class="bu">len</span>(key) <span class="op">&gt;=</span> <span class="dv">20</span> <span class="kw">and</span> key.startswith(<span class="st">&#39;sk-&#39;</span>):</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;OpenAI API key verified in environment (length: </span><span class="sc">{</span><span class="bu">len</span>(key)<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true"></a>            <span class="cf">else</span>:</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="st">&quot;X OpenAI API key not properly set in environment.&quot;</span>)</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true"></a>                <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true"></a>        <span class="cf">elif</span> provider <span class="op">==</span> <span class="st">&quot;google_genai&quot;</span>:</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true"></a>            <span class="cf">if</span> key <span class="kw">and</span> <span class="bu">len</span>(key) <span class="op">&gt;=</span> <span class="dv">20</span>:</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Google API key verified in environment (length: </span><span class="sc">{</span><span class="bu">len</span>(key)<span class="sc">}</span><span class="ss">)&quot;</span>)</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true"></a>            <span class="cf">else</span>:</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="st">&quot;X Google API key not properly set in environment.&quot;</span>)</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true"></a>                <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true"></a></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true"></a></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true"></a></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true"></a>    <span class="kw">def</span> setup_google_drive(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true"></a>        <span class="cf">try</span>:</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true"></a>            <span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true"></a>            drive.mount(<span class="st">&#39;/content/drive&#39;</span>)</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true"></a>            logger.info(<span class="st">&quot;Google Drive accessed.&quot;</span>)</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true"></a></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true"></a>            <span class="co"># RAG folder.</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true"></a>            <span class="va">self</span>.rag_folder <span class="op">=</span> <span class="va">self</span>._find_rag_folder()</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true"></a>            <span class="cf">if</span> <span class="va">self</span>.rag_folder:</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true"></a>                <span class="cf">return</span> <span class="va">self</span>.rag_folder</span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true"></a>            <span class="cf">else</span>:</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true"></a>                logger.warning(<span class="st">&quot;RAG folder not found.&quot;</span>)</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true"></a>                <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true"></a></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true"></a>        <span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true"></a>            logger.info(<span class="st">&quot;Google Colab not detected, running in local mode.&quot;</span>)</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true"></a>            logger.error(<span class="ss">f&quot;Error setting up Google Drive: </span><span class="sc">{e}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true"></a></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true"></a></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true"></a>    <span class="kw">def</span> _find_rag_folder(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">str</span>]:</span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true"></a>        possible_paths <span class="op">=</span> [</span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true"></a>            <span class="st">&quot;/content/drive/MyDrive/Rag&quot;</span>,</span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true"></a>            <span class="st">&quot;/content/drive/My Drive/Rag&quot;</span>,</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true"></a>            <span class="st">&quot;/content/drive/MyDrive/rag&quot;</span>,</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true"></a>            <span class="st">&quot;/content/drive/My Drive/rag&quot;</span>,</span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true"></a>            <span class="st">&quot;/content/drive/MyDrive/RAG&quot;</span>,</span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true"></a>            <span class="st">&quot;/content/drive/My Drive/RAG&quot;</span></span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true"></a>        ]</span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true"></a></span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true"></a>        <span class="cf">for</span> path <span class="kw">in</span> possible_paths:</span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true"></a>            <span class="cf">if</span> os.path.exists(path):</span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Found RAG folder at: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true"></a>                <span class="cf">return</span> path</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true"></a></span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;Folder not found in locations.&quot;</span>)</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true"></a></span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true"></a>        search_paths <span class="op">=</span> [</span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true"></a>            <span class="st">&quot;/content/drive/MyDrive&quot;</span>,</span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true"></a>            <span class="st">&quot;/content/drive/My Drive&quot;</span></span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true"></a>        ]</span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true"></a></span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true"></a>        <span class="cf">for</span> search_path <span class="kw">in</span> search_paths:</span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true"></a>            <span class="cf">if</span> os.path.exists(search_path):</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true"></a>                <span class="cf">for</span> item <span class="kw">in</span> os.listdir(search_path):</span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true"></a>                    item_path <span class="op">=</span> os.path.join(search_path, item)</span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true"></a>                    <span class="cf">if</span> os.path.isdir(item_path) <span class="kw">and</span> item.lower() <span class="op">==</span> <span class="st">&#39;rag&#39;</span>:</span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true"></a>                        <span class="bu">print</span>(<span class="ss">f&quot;Found RAG folder at: </span><span class="sc">{</span>item_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true"></a>                        <span class="cf">return</span> item_path</span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true"></a></span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true"></a>                <span class="cf">for</span> item <span class="kw">in</span> os.listdir(search_path):</span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true"></a>                    item_path <span class="op">=</span> os.path.join(search_path, item)</span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true"></a>                    <span class="cf">if</span> os.path.isdir(item_path):</span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true"></a>                        <span class="cf">try</span>:</span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true"></a>                            <span class="cf">for</span> subitem <span class="kw">in</span> os.listdir(item_path):</span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true"></a>                                subitem_path <span class="op">=</span> os.path.join(item_path, subitem)</span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true"></a>                                <span class="cf">if</span> os.path.isdir(subitem_path) <span class="kw">and</span> subitem.lower() <span class="op">==</span> <span class="st">&#39;rag&#39;</span>:</span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true"></a>                                    <span class="bu">print</span>(</span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true"></a>                                        <span class="ss">f&quot;Found RAG folder at: </span><span class="sc">{</span>subitem_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true"></a>                                    <span class="cf">return</span> subitem_path</span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true"></a>                        <span class="cf">except</span> <span class="pp">PermissionError</span>:</span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true"></a>                            <span class="cf">continue</span></span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true"></a></span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true"></a></span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true"></a></span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true"></a>    <span class="kw">def</span> list_available_folders(<span class="va">self</span>):</span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Folders.&quot;</span>)</span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true"></a></span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true"></a>        drive_paths <span class="op">=</span> [<span class="st">&quot;/content/drive/MyDrive&quot;</span>, <span class="st">&quot;/content/drive/My Drive&quot;</span>]</span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true"></a>        <span class="cf">for</span> drive_path <span class="kw">in</span> drive_paths:</span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true"></a>            <span class="cf">if</span> os.path.exists(drive_path):</span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss"> Folders in </span><span class="sc">{</span>drive_path<span class="sc">}</span><span class="ss">:&quot;</span>)</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true"></a>                <span class="cf">try</span>:</span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true"></a>                    <span class="cf">for</span> item <span class="kw">in</span> os.listdir(drive_path):</span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true"></a>                        item_path <span class="op">=</span> os.path.join(drive_path, item)</span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true"></a>                        <span class="cf">if</span> os.path.isdir(item_path):</span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true"></a>                            <span class="bu">print</span>(<span class="ss">f&quot;  </span><span class="sc">{</span>item<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true"></a>                    <span class="bu">print</span>(<span class="ss">f&quot;  Error reading </span><span class="sc">{</span>drive_path<span class="sc">}</span><span class="ss">: </span><span class="sc">{e}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true"></a></span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true"></a></span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true"></a>    <span class="kw">def</span> load_documents(<span class="va">self</span>, folder_path: <span class="bu">str</span>) <span class="op">-&gt;</span> List:</span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(folder_path):</span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f&quot;Folder not found: </span><span class="sc">{</span>folder_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true"></a></span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true"></a>        <span class="co"># PDF files.</span></span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true"></a>        pdf_pattern <span class="op">=</span> os.path.join(folder_path, <span class="st">&quot;*.pdf&quot;</span>)</span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true"></a>        pdf_files <span class="op">=</span> glob.glob(pdf_pattern)</span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true"></a></span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> pdf_files:</span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f&quot;No PDF files found in folder: </span><span class="sc">{</span>folder_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true"></a></span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true"></a>        logger.info(<span class="ss">f&quot;Found </span><span class="sc">{</span><span class="bu">len</span>(pdf_files)<span class="sc">}</span><span class="ss"> PDF files&quot;</span>)</span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true"></a></span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true"></a>        <span class="co"># Loading the documents.</span></span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true"></a>        documents <span class="op">=</span> []</span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true"></a>        <span class="cf">for</span> pdf_file <span class="kw">in</span> pdf_files:</span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true"></a>            <span class="cf">try</span>:</span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true"></a>                logger.info(<span class="ss">f&quot;Processing: </span><span class="sc">{os.</span>path<span class="sc">.</span>basename(pdf_file)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true"></a>                loader <span class="op">=</span> PyPDFLoader(pdf_file)</span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true"></a>                file_documents <span class="op">=</span> loader.load()</span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true"></a></span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true"></a>                <span class="co"># Adding metadata.</span></span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true"></a>                <span class="cf">for</span> doc <span class="kw">in</span> file_documents:</span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true"></a>                    doc.metadata[<span class="st">&#39;source&#39;</span>] <span class="op">=</span> os.path.basename(pdf_file)</span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true"></a>                    doc.metadata[<span class="st">&#39;file_path&#39;</span>] <span class="op">=</span> pdf_file</span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true"></a></span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true"></a>                documents.extend(file_documents)</span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true"></a>                logger.info(</span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true"></a>                    <span class="ss">f&quot;Loaded </span><span class="sc">{</span><span class="bu">len</span>(file_documents)<span class="sc">}</span><span class="ss"> pages from </span><span class="sc">{os.</span>path<span class="sc">.</span>basename(pdf_file)<span class="sc">}</span><span class="ss">.&quot;</span>)</span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true"></a></span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true"></a>                logger.error(<span class="ss">f&quot;Error loading </span><span class="sc">{</span>pdf_file<span class="sc">}</span><span class="ss">: </span><span class="sc">{e}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true"></a>                <span class="cf">continue</span></span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true"></a></span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true"></a>        <span class="va">self</span>.documents <span class="op">=</span> documents</span>
<span id="cb5-218"><a href="#cb5-218" aria-hidden="true"></a>        logger.info(<span class="ss">f&quot;Total pages loaded: </span><span class="sc">{</span><span class="bu">len</span>(documents)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-219"><a href="#cb5-219" aria-hidden="true"></a>        <span class="cf">return</span> documents</span>
<span id="cb5-220"><a href="#cb5-220" aria-hidden="true"></a></span>
<span id="cb5-221"><a href="#cb5-221" aria-hidden="true"></a></span>
<span id="cb5-222"><a href="#cb5-222" aria-hidden="true"></a><span class="co"># Creates vector store from the documents and uses the fine-tuned model only if enabled.</span></span>
<span id="cb5-223"><a href="#cb5-223" aria-hidden="true"></a>    <span class="kw">def</span> create_vector_store(<span class="va">self</span>, documents: List <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb5-224"><a href="#cb5-224" aria-hidden="true"></a>        <span class="cf">if</span> documents:</span>
<span id="cb5-225"><a href="#cb5-225" aria-hidden="true"></a>            <span class="va">self</span>.documents <span class="op">=</span> documents</span>
<span id="cb5-226"><a href="#cb5-226" aria-hidden="true"></a></span>
<span id="cb5-227"><a href="#cb5-227" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.documents:</span>
<span id="cb5-228"><a href="#cb5-228" aria-hidden="true"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;No documents loaded.&quot;</span>)</span>
<span id="cb5-229"><a href="#cb5-229" aria-hidden="true"></a></span>
<span id="cb5-230"><a href="#cb5-230" aria-hidden="true"></a>        <span class="co"># Deciding which embeddings to use.</span></span>
<span id="cb5-231"><a href="#cb5-231" aria-hidden="true"></a>        <span class="cf">if</span> <span class="va">self</span>.use_fine_tuned <span class="kw">and</span> os.path.exists(<span class="va">self</span>.fine_tuned_model_path):</span>
<span id="cb5-232"><a href="#cb5-232" aria-hidden="true"></a>            <span class="cf">try</span>:</span>
<span id="cb5-233"><a href="#cb5-233" aria-hidden="true"></a>                <span class="im">from</span> sentence_transformers <span class="im">import</span> SentenceTransformer</span>
<span id="cb5-234"><a href="#cb5-234" aria-hidden="true"></a></span>
<span id="cb5-235"><a href="#cb5-235" aria-hidden="true"></a><span class="co"># Embeddings class that wraps the fine-tuned sentence transformer.</span></span>
<span id="cb5-236"><a href="#cb5-236" aria-hidden="true"></a>                <span class="kw">class</span> FineTunedEmbeddings:</span>
<span id="cb5-237"><a href="#cb5-237" aria-hidden="true"></a>                    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, model_path: <span class="bu">str</span>):</span>
<span id="cb5-238"><a href="#cb5-238" aria-hidden="true"></a>                        <span class="va">self</span>.model <span class="op">=</span> SentenceTransformer(model_path)</span>
<span id="cb5-239"><a href="#cb5-239" aria-hidden="true"></a>                    <span class="kw">def</span> embed_documents(<span class="va">self</span>, texts: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> List[List[<span class="bu">float</span>]]:</span>
<span id="cb5-240"><a href="#cb5-240" aria-hidden="true"></a>                        <span class="cf">return</span> <span class="va">self</span>.model.encode(texts, convert_to_tensor<span class="op">=</span><span class="va">False</span>).tolist()</span>
<span id="cb5-241"><a href="#cb5-241" aria-hidden="true"></a>                    <span class="kw">def</span> embed_query(<span class="va">self</span>, text: <span class="bu">str</span>) <span class="op">-&gt;</span> List[<span class="bu">float</span>]:</span>
<span id="cb5-242"><a href="#cb5-242" aria-hidden="true"></a>                        <span class="cf">return</span> <span class="va">self</span>.model.encode(text, convert_to_tensor<span class="op">=</span><span class="va">False</span>).tolist()</span>
<span id="cb5-243"><a href="#cb5-243" aria-hidden="true"></a></span>
<span id="cb5-244"><a href="#cb5-244" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Using fine-tuned embeddings from: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>fine_tuned_model_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-245"><a href="#cb5-245" aria-hidden="true"></a>                <span class="va">self</span>.embeddings_model <span class="op">=</span> FineTunedEmbeddings(<span class="va">self</span>.fine_tuned_model_path)</span>
<span id="cb5-246"><a href="#cb5-246" aria-hidden="true"></a>            <span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb5-247"><a href="#cb5-247" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="st">&quot;sentence-transformers not available, falling back to default embeddings.&quot;</span>)</span>
<span id="cb5-248"><a href="#cb5-248" aria-hidden="true"></a>                <span class="va">self</span>.embeddings_model <span class="op">=</span> <span class="va">self</span>._get_default_embeddings()</span>
<span id="cb5-249"><a href="#cb5-249" aria-hidden="true"></a>        <span class="cf">else</span>:</span>
<span id="cb5-250"><a href="#cb5-250" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;Using standard embeddings.&quot;</span>)</span>
<span id="cb5-251"><a href="#cb5-251" aria-hidden="true"></a>            <span class="va">self</span>.embeddings_model <span class="op">=</span> <span class="va">self</span>._get_default_embeddings()</span>
<span id="cb5-252"><a href="#cb5-252" aria-hidden="true"></a></span>
<span id="cb5-253"><a href="#cb5-253" aria-hidden="true"></a></span>
<span id="cb5-254"><a href="#cb5-254" aria-hidden="true"></a>        <span class="co"># Splitting docs.</span></span>
<span id="cb5-255"><a href="#cb5-255" aria-hidden="true"></a>        text_splitter <span class="op">=</span> RecursiveCharacterTextSplitter(</span>
<span id="cb5-256"><a href="#cb5-256" aria-hidden="true"></a>            chunk_size<span class="op">=</span><span class="va">self</span>.chunk_size,</span>
<span id="cb5-257"><a href="#cb5-257" aria-hidden="true"></a>            chunk_overlap<span class="op">=</span><span class="va">self</span>.chunk_overlap,</span>
<span id="cb5-258"><a href="#cb5-258" aria-hidden="true"></a>            length_function<span class="op">=</span><span class="bu">len</span>,</span>
<span id="cb5-259"><a href="#cb5-259" aria-hidden="true"></a>        )</span>
<span id="cb5-260"><a href="#cb5-260" aria-hidden="true"></a>        chunks <span class="op">=</span> text_splitter.split_documents(<span class="va">self</span>.documents)</span>
<span id="cb5-261"><a href="#cb5-261" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Created </span><span class="sc">{</span><span class="bu">len</span>(chunks)<span class="sc">}</span><span class="ss"> text chunks&quot;</span>)</span>
<span id="cb5-262"><a href="#cb5-262" aria-hidden="true"></a></span>
<span id="cb5-263"><a href="#cb5-263" aria-hidden="true"></a>        <span class="co"># Building the vector store.</span></span>
<span id="cb5-264"><a href="#cb5-264" aria-hidden="true"></a>        <span class="va">self</span>.vectorstore <span class="op">=</span> Chroma.from_documents(</span>
<span id="cb5-265"><a href="#cb5-265" aria-hidden="true"></a>            documents<span class="op">=</span>chunks,</span>
<span id="cb5-266"><a href="#cb5-266" aria-hidden="true"></a>            embedding<span class="op">=</span><span class="va">self</span>.embeddings_model,</span>
<span id="cb5-267"><a href="#cb5-267" aria-hidden="true"></a>            collection_name<span class="op">=</span><span class="st">&quot;academic_papers&quot;</span></span>
<span id="cb5-268"><a href="#cb5-268" aria-hidden="true"></a>        )</span>
<span id="cb5-269"><a href="#cb5-269" aria-hidden="true"></a>        <span class="va">self</span>.retriever <span class="op">=</span> <span class="va">self</span>.vectorstore.as_retriever(</span>
<span id="cb5-270"><a href="#cb5-270" aria-hidden="true"></a>            search_type<span class="op">=</span><span class="st">&quot;similarity&quot;</span>,</span>
<span id="cb5-271"><a href="#cb5-271" aria-hidden="true"></a>            search_kwargs<span class="op">=</span>{<span class="st">&quot;k&quot;</span>: <span class="va">self</span>.retrieval_k}</span>
<span id="cb5-272"><a href="#cb5-272" aria-hidden="true"></a>        )</span>
<span id="cb5-273"><a href="#cb5-273" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;Vector store created.&quot;</span>)</span>
<span id="cb5-274"><a href="#cb5-274" aria-hidden="true"></a></span>
<span id="cb5-275"><a href="#cb5-275" aria-hidden="true"></a>    <span class="co"># def _get_default_embeddings(self):</span></span>
<span id="cb5-276"><a href="#cb5-276" aria-hidden="true"></a>    <span class="co">#         &quot;&quot;&quot;Get default embeddings based on provider&quot;&quot;&quot;</span></span>
<span id="cb5-277"><a href="#cb5-277" aria-hidden="true"></a>    <span class="co">#         if self.model_provider == &quot;google_genai&quot;:</span></span>
<span id="cb5-278"><a href="#cb5-278" aria-hidden="true"></a>    <span class="co">#             return GoogleGenerativeAIEmbeddings(model=&quot;models/embedding-001&quot;)</span></span>
<span id="cb5-279"><a href="#cb5-279" aria-hidden="true"></a>    <span class="co">#         elif self.model_provider == &quot;openai&quot;:</span></span>
<span id="cb5-280"><a href="#cb5-280" aria-hidden="true"></a>    <span class="co">#             return OpenAIEmbeddings()</span></span>
<span id="cb5-281"><a href="#cb5-281" aria-hidden="true"></a>    <span class="co">#         else:</span></span>
<span id="cb5-282"><a href="#cb5-282" aria-hidden="true"></a>    <span class="co">#             raise ValueError(f&quot;Unsupported model provider: {self.model_provider}.&quot;)</span></span>
<span id="cb5-283"><a href="#cb5-283" aria-hidden="true"></a></span>
<span id="cb5-284"><a href="#cb5-284" aria-hidden="true"></a></span>
<span id="cb5-285"><a href="#cb5-285" aria-hidden="true"></a>    <span class="kw">def</span> _get_default_embeddings(<span class="va">self</span>):</span>
<span id="cb5-286"><a href="#cb5-286" aria-hidden="true"></a>        <span class="cf">return</span> HuggingFaceEmbeddings(model_name<span class="op">=</span><span class="st">&quot;sentence-transformers/all-MiniLM-L6-v2&quot;</span>)</span>
<span id="cb5-287"><a href="#cb5-287" aria-hidden="true"></a></span>
<span id="cb5-288"><a href="#cb5-288" aria-hidden="true"></a><span class="co"># Evaluating the retrieval accuracy using ground-truth Q/A pairs. If qa_pairs are not provided, it loads it from the datasets.</span></span>
<span id="cb5-289"><a href="#cb5-289" aria-hidden="true"></a></span>
<span id="cb5-290"><a href="#cb5-290" aria-hidden="true"></a>    <span class="kw">def</span> evaluate_retrieval(<span class="va">self</span>, qa_pairs<span class="op">=</span><span class="va">None</span>, k_values<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>]):</span>
<span id="cb5-291"><a href="#cb5-291" aria-hidden="true"></a></span>
<span id="cb5-292"><a href="#cb5-292" aria-hidden="true"></a>        <span class="co"># Loading the Q/A dataset.</span></span>
<span id="cb5-293"><a href="#cb5-293" aria-hidden="true"></a>        <span class="cf">if</span> qa_pairs <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb5-294"><a href="#cb5-294" aria-hidden="true"></a>            <span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="st">&quot;/content/drive/MyDrive/datasets/qa_pairs.csv&quot;</span>):</span>
<span id="cb5-295"><a href="#cb5-295" aria-hidden="true"></a>                <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">&quot;No qa_pairs provided and /content/drive/MyDrive/datasets/qa_pairs.csv not found!&quot;</span>)</span>
<span id="cb5-296"><a href="#cb5-296" aria-hidden="true"></a>            df <span class="op">=</span> pd.read_csv(<span class="st">&quot;/content/drive/MyDrive/datasets/qa_pairs.csv&quot;</span>)</span>
<span id="cb5-297"><a href="#cb5-297" aria-hidden="true"></a>            qa_pairs <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(df[<span class="st">&quot;query&quot;</span>].tolist(), df[<span class="st">&quot;answer&quot;</span>].tolist()))</span>
<span id="cb5-298"><a href="#cb5-298" aria-hidden="true"></a></span>
<span id="cb5-299"><a href="#cb5-299" aria-hidden="true"></a>        queries <span class="op">=</span> [q <span class="cf">for</span> q, _ <span class="kw">in</span> qa_pairs]</span>
<span id="cb5-300"><a href="#cb5-300" aria-hidden="true"></a>        answers <span class="op">=</span> [a <span class="cf">for</span> _, a <span class="kw">in</span> qa_pairs]</span>
<span id="cb5-301"><a href="#cb5-301" aria-hidden="true"></a></span>
<span id="cb5-302"><a href="#cb5-302" aria-hidden="true"></a>        <span class="co"># Embed queries and answers with the retriever&#39;s embeddings.</span></span>
<span id="cb5-303"><a href="#cb5-303" aria-hidden="true"></a>        query_embs <span class="op">=</span> <span class="va">self</span>.embeddings_model.embed_documents(queries)</span>
<span id="cb5-304"><a href="#cb5-304" aria-hidden="true"></a>        doc_embs <span class="op">=</span> <span class="va">self</span>.embeddings_model.embed_documents(answers)</span>
<span id="cb5-305"><a href="#cb5-305" aria-hidden="true"></a></span>
<span id="cb5-306"><a href="#cb5-306" aria-hidden="true"></a>        sim_matrix <span class="op">=</span> cosine_similarity(query_embs, doc_embs)</span>
<span id="cb5-307"><a href="#cb5-307" aria-hidden="true"></a></span>
<span id="cb5-308"><a href="#cb5-308" aria-hidden="true"></a>        metrics <span class="op">=</span> {}</span>
<span id="cb5-309"><a href="#cb5-309" aria-hidden="true"></a>        <span class="cf">for</span> k <span class="kw">in</span> k_values:</span>
<span id="cb5-310"><a href="#cb5-310" aria-hidden="true"></a>            correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-311"><a href="#cb5-311" aria-hidden="true"></a>            mrr_total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-312"><a href="#cb5-312" aria-hidden="true"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(queries)):</span>
<span id="cb5-313"><a href="#cb5-313" aria-hidden="true"></a>                scores <span class="op">=</span> sim_matrix[i]</span>
<span id="cb5-314"><a href="#cb5-314" aria-hidden="true"></a>                topk_idx <span class="op">=</span> np.argsort(scores)[::<span class="op">-</span><span class="dv">1</span>][:k]</span>
<span id="cb5-315"><a href="#cb5-315" aria-hidden="true"></a>                <span class="cf">if</span> i <span class="kw">in</span> topk_idx:</span>
<span id="cb5-316"><a href="#cb5-316" aria-hidden="true"></a>                    correct <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-317"><a href="#cb5-317" aria-hidden="true"></a>                    rank <span class="op">=</span> np.where(topk_idx <span class="op">==</span> i)[<span class="dv">0</span>][<span class="dv">0</span>] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb5-318"><a href="#cb5-318" aria-hidden="true"></a>                    mrr_total <span class="op">+=</span> <span class="fl">1.0</span> <span class="op">/</span> rank</span>
<span id="cb5-319"><a href="#cb5-319" aria-hidden="true"></a>            recall <span class="op">=</span> correct <span class="op">/</span> <span class="bu">len</span>(queries)</span>
<span id="cb5-320"><a href="#cb5-320" aria-hidden="true"></a>            mrr <span class="op">=</span> mrr_total <span class="op">/</span> <span class="bu">len</span>(queries)</span>
<span id="cb5-321"><a href="#cb5-321" aria-hidden="true"></a>            metrics[<span class="ss">f&quot;Recall@</span><span class="sc">{k}</span><span class="ss">&quot;</span>] <span class="op">=</span> recall</span>
<span id="cb5-322"><a href="#cb5-322" aria-hidden="true"></a>            metrics[<span class="ss">f&quot;MRR@</span><span class="sc">{k}</span><span class="ss">&quot;</span>] <span class="op">=</span> mrr</span>
<span id="cb5-323"><a href="#cb5-323" aria-hidden="true"></a></span>
<span id="cb5-324"><a href="#cb5-324" aria-hidden="true"></a>        <span class="cf">return</span> metrics</span>
<span id="cb5-325"><a href="#cb5-325" aria-hidden="true"></a></span>
<span id="cb5-326"><a href="#cb5-326" aria-hidden="true"></a><span class="co"># Compares the baseline and the fine-tuned retrievers on the same Q/A dataset.</span></span>
<span id="cb5-327"><a href="#cb5-327" aria-hidden="true"></a>    <span class="kw">def</span> compare_fine_tuned_vs_baseline(<span class="va">self</span>):</span>
<span id="cb5-328"><a href="#cb5-328" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;Fine-tuned vs Baseline&quot;</span>)</span>
<span id="cb5-329"><a href="#cb5-329" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;-&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb5-330"><a href="#cb5-330" aria-hidden="true"></a></span>
<span id="cb5-331"><a href="#cb5-331" aria-hidden="true"></a>        <span class="co"># Baseline RAG.</span></span>
<span id="cb5-332"><a href="#cb5-332" aria-hidden="true"></a>        baseline_rag <span class="op">=</span> AcademicRAG(use_fine_tuned<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-333"><a href="#cb5-333" aria-hidden="true"></a>        baseline_rag.load_documents(<span class="va">self</span>.rag_folder)</span>
<span id="cb5-334"><a href="#cb5-334" aria-hidden="true"></a>        baseline_rag.create_vector_store()</span>
<span id="cb5-335"><a href="#cb5-335" aria-hidden="true"></a>        baseline_metrics <span class="op">=</span> baseline_rag.evaluate_retrieval()</span>
<span id="cb5-336"><a href="#cb5-336" aria-hidden="true"></a></span>
<span id="cb5-337"><a href="#cb5-337" aria-hidden="true"></a>        <span class="co"># Fine-tuned RAG.</span></span>
<span id="cb5-338"><a href="#cb5-338" aria-hidden="true"></a>        fine_rag <span class="op">=</span> AcademicRAG(use_fine_tuned<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-339"><a href="#cb5-339" aria-hidden="true"></a>        fine_rag.load_documents(<span class="va">self</span>.rag_folder)</span>
<span id="cb5-340"><a href="#cb5-340" aria-hidden="true"></a>        fine_rag.create_vector_store()</span>
<span id="cb5-341"><a href="#cb5-341" aria-hidden="true"></a>        fine_metrics <span class="op">=</span> fine_rag.evaluate_retrieval()</span>
<span id="cb5-342"><a href="#cb5-342" aria-hidden="true"></a></span>
<span id="cb5-343"><a href="#cb5-343" aria-hidden="true"></a>        <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-344"><a href="#cb5-344" aria-hidden="true"></a></span>
<span id="cb5-345"><a href="#cb5-345" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Evaluation Metrics for the Baseline vs Fine-tuned:&quot;</span>)</span>
<span id="cb5-346"><a href="#cb5-346" aria-hidden="true"></a>        table_data <span class="op">=</span> []</span>
<span id="cb5-347"><a href="#cb5-347" aria-hidden="true"></a>        <span class="cf">for</span> key <span class="kw">in</span> baseline_metrics.keys():</span>
<span id="cb5-348"><a href="#cb5-348" aria-hidden="true"></a>            b <span class="op">=</span> baseline_metrics[key]</span>
<span id="cb5-349"><a href="#cb5-349" aria-hidden="true"></a>            f <span class="op">=</span> fine_metrics[key]</span>
<span id="cb5-350"><a href="#cb5-350" aria-hidden="true"></a>            diff <span class="op">=</span> (f <span class="op">-</span> b) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb5-351"><a href="#cb5-351" aria-hidden="true"></a>            table_data.append({</span>
<span id="cb5-352"><a href="#cb5-352" aria-hidden="true"></a>                <span class="st">&quot;Metric&quot;</span>: key,</span>
<span id="cb5-353"><a href="#cb5-353" aria-hidden="true"></a>                <span class="st">&quot;Baseline&quot;</span>: <span class="bu">round</span>(b, <span class="dv">3</span>),</span>
<span id="cb5-354"><a href="#cb5-354" aria-hidden="true"></a>                <span class="st">&quot;Fine-tuned&quot;</span>: <span class="bu">round</span>(f, <span class="dv">3</span>),</span>
<span id="cb5-355"><a href="#cb5-355" aria-hidden="true"></a>                <span class="st">&quot;Change (%)&quot;</span>: <span class="bu">round</span>(diff, <span class="dv">1</span>)</span>
<span id="cb5-356"><a href="#cb5-356" aria-hidden="true"></a>            })</span>
<span id="cb5-357"><a href="#cb5-357" aria-hidden="true"></a>        df <span class="op">=</span> pd.DataFrame(table_data)</span>
<span id="cb5-358"><a href="#cb5-358" aria-hidden="true"></a>        <span class="bu">print</span>(df)</span>
<span id="cb5-359"><a href="#cb5-359" aria-hidden="true"></a></span>
<span id="cb5-360"><a href="#cb5-360" aria-hidden="true"></a>        <span class="cf">return</span> baseline_metrics, fine_metrics</span>
<span id="cb5-361"><a href="#cb5-361" aria-hidden="true"></a></span>
<span id="cb5-362"><a href="#cb5-362" aria-hidden="true"></a></span>
<span id="cb5-363"><a href="#cb5-363" aria-hidden="true"></a><span class="co"># Custom prompt template for better RAG responses.</span></span>
<span id="cb5-364"><a href="#cb5-364" aria-hidden="true"></a>    <span class="kw">def</span> _create_custom_prompt(<span class="va">self</span>):</span>
<span id="cb5-365"><a href="#cb5-365" aria-hidden="true"></a>        prompt_template <span class="op">=</span> <span class="st">&quot;&quot;&quot;You are an expert academic research assistant. Your task is to provide comprehensive, accurate answers based on the provided context from academic papers.</span></span>
<span id="cb5-366"><a href="#cb5-366" aria-hidden="true"></a></span>
<span id="cb5-367"><a href="#cb5-367" aria-hidden="true"></a><span class="st">IMPORTANT INSTRUCTIONS:</span></span>
<span id="cb5-368"><a href="#cb5-368" aria-hidden="true"></a><span class="st">1. **Always include specific details**: Mention author names, publication years, specific numbers, percentages, and concrete examples when they appear in the context.</span></span>
<span id="cb5-369"><a href="#cb5-369" aria-hidden="true"></a><span class="st">2. **Be precise**: Use exact figures, statistics, and measurements as stated in the documents.</span></span>
<span id="cb5-370"><a href="#cb5-370" aria-hidden="true"></a><span class="st">3. **Maintain academic tone**: Write in a scholarly, professional manner.</span></span>
<span id="cb5-371"><a href="#cb5-371" aria-hidden="true"></a><span class="st">4. **Structure your response**: Organize information logically with clear sections if appropriate.</span></span>
<span id="cb5-372"><a href="#cb5-372" aria-hidden="true"></a><span class="st">5. **Cite sources**: When possible, reference which document/page the information comes from.</span></span>
<span id="cb5-373"><a href="#cb5-373" aria-hidden="true"></a><span class="st">6. **Include quantitative data**: Always mention specific numbers, percentages, and metrics when available.</span></span>
<span id="cb5-374"><a href="#cb5-374" aria-hidden="true"></a><span class="st">7. **Provide context**: Explain the significance and implications of the findings.</span></span>
<span id="cb5-375"><a href="#cb5-375" aria-hidden="true"></a><span class="st">8. **Be comprehensive**: Don&#39;t skip important details that are present in the context.</span></span>
<span id="cb5-376"><a href="#cb5-376" aria-hidden="true"></a></span>
<span id="cb5-377"><a href="#cb5-377" aria-hidden="true"></a><span class="st">CONTEXT INFORMATION:</span></span>
<span id="cb5-378"><a href="#cb5-378" aria-hidden="true"></a><span class="sc">{context}</span></span>
<span id="cb5-379"><a href="#cb5-379" aria-hidden="true"></a></span>
<span id="cb5-380"><a href="#cb5-380" aria-hidden="true"></a><span class="st">QUESTION: </span><span class="sc">{question}</span></span>
<span id="cb5-381"><a href="#cb5-381" aria-hidden="true"></a></span>
<span id="cb5-382"><a href="#cb5-382" aria-hidden="true"></a><span class="st">Please provide a comprehensive answer that includes all relevant specific details, numbers, and examples from the context. Structure your response to directly address the question while incorporating all pertinent information from the provided context. If the context doesn&#39;t contain enough information to fully answer the question, say so clearly.</span></span>
<span id="cb5-383"><a href="#cb5-383" aria-hidden="true"></a></span>
<span id="cb5-384"><a href="#cb5-384" aria-hidden="true"></a><span class="st">ANSWER:&quot;&quot;&quot;</span></span>
<span id="cb5-385"><a href="#cb5-385" aria-hidden="true"></a></span>
<span id="cb5-386"><a href="#cb5-386" aria-hidden="true"></a>        <span class="cf">return</span> ChatPromptTemplate.from_template(prompt_template)</span>
<span id="cb5-387"><a href="#cb5-387" aria-hidden="true"></a></span>
<span id="cb5-388"><a href="#cb5-388" aria-hidden="true"></a></span>
<span id="cb5-389"><a href="#cb5-389" aria-hidden="true"></a><span class="co"># Context by combining and organizing chunks for a better understanding.</span></span>
<span id="cb5-390"><a href="#cb5-390" aria-hidden="true"></a>    <span class="kw">def</span> _enhance_context(<span class="va">self</span>, context_docs):</span>
<span id="cb5-391"><a href="#cb5-391" aria-hidden="true"></a>        enhanced_context <span class="op">=</span> []</span>
<span id="cb5-392"><a href="#cb5-392" aria-hidden="true"></a></span>
<span id="cb5-393"><a href="#cb5-393" aria-hidden="true"></a>        <span class="cf">for</span> i, doc <span class="kw">in</span> <span class="bu">enumerate</span>(context_docs):</span>
<span id="cb5-394"><a href="#cb5-394" aria-hidden="true"></a>            enhanced_content <span class="op">=</span> <span class="ss">f&quot;[Chunk </span><span class="sc">{i</span><span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> from </span><span class="sc">{</span>doc<span class="sc">.</span>metadata<span class="sc">.</span>get(<span class="st">&#39;source&#39;</span>, <span class="st">&#39;Unknown&#39;</span>)<span class="sc">}</span><span class="ss">, Page </span><span class="sc">{</span>doc<span class="sc">.</span>metadata<span class="sc">.</span>get(<span class="st">&#39;page&#39;</span>, <span class="st">&#39;Unknown&#39;</span>)<span class="sc">}</span><span class="ss">]</span><span class="ch">\n</span><span class="sc">{</span>doc<span class="sc">.</span>page_content<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb5-395"><a href="#cb5-395" aria-hidden="true"></a>            enhanced_context.append(enhanced_content)</span>
<span id="cb5-396"><a href="#cb5-396" aria-hidden="true"></a></span>
<span id="cb5-397"><a href="#cb5-397" aria-hidden="true"></a>        <span class="co"># Joining all the chunks.</span></span>
<span id="cb5-398"><a href="#cb5-398" aria-hidden="true"></a>        <span class="cf">return</span> <span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">---</span><span class="ch">\n\n</span><span class="st">&quot;</span>.join(enhanced_context)</span>
<span id="cb5-399"><a href="#cb5-399" aria-hidden="true"></a></span>
<span id="cb5-400"><a href="#cb5-400" aria-hidden="true"></a><span class="co"># RAG.</span></span>
<span id="cb5-401"><a href="#cb5-401" aria-hidden="true"></a>    <span class="kw">def</span> setup_rag_chain(<span class="va">self</span>):</span>
<span id="cb5-402"><a href="#cb5-402" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.retriever:</span>
<span id="cb5-403"><a href="#cb5-403" aria-hidden="true"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb5-404"><a href="#cb5-404" aria-hidden="true"></a>                <span class="st">&quot;Vector store not created.&quot;</span>)</span>
<span id="cb5-405"><a href="#cb5-405" aria-hidden="true"></a></span>
<span id="cb5-406"><a href="#cb5-406" aria-hidden="true"></a>        <span class="co"># LLM.</span></span>
<span id="cb5-407"><a href="#cb5-407" aria-hidden="true"></a>        llm <span class="op">=</span> init_chat_model(<span class="va">self</span>.model_name,</span>
<span id="cb5-408"><a href="#cb5-408" aria-hidden="true"></a>                              model_provider<span class="op">=</span><span class="va">self</span>.model_provider,</span>
<span id="cb5-409"><a href="#cb5-409" aria-hidden="true"></a>                              temperature<span class="op">=</span><span class="va">self</span>.temperature)</span>
<span id="cb5-410"><a href="#cb5-410" aria-hidden="true"></a></span>
<span id="cb5-411"><a href="#cb5-411" aria-hidden="true"></a>        <span class="co"># Custom prompt.</span></span>
<span id="cb5-412"><a href="#cb5-412" aria-hidden="true"></a>        prompt <span class="op">=</span> <span class="va">self</span>._create_custom_prompt()</span>
<span id="cb5-413"><a href="#cb5-413" aria-hidden="true"></a></span>
<span id="cb5-414"><a href="#cb5-414" aria-hidden="true"></a>        <span class="co"># RAG chain with enhanced context processing.</span></span>
<span id="cb5-415"><a href="#cb5-415" aria-hidden="true"></a>        <span class="kw">def</span> rag_chain(question):</span>
<span id="cb5-416"><a href="#cb5-416" aria-hidden="true"></a>            <span class="cf">try</span>:</span>
<span id="cb5-417"><a href="#cb5-417" aria-hidden="true"></a>                <span class="co"># Relevant documents.</span></span>
<span id="cb5-418"><a href="#cb5-418" aria-hidden="true"></a>                context_docs <span class="op">=</span> <span class="va">self</span>.retriever.invoke(question)</span>
<span id="cb5-419"><a href="#cb5-419" aria-hidden="true"></a></span>
<span id="cb5-420"><a href="#cb5-420" aria-hidden="true"></a>                enhanced_context <span class="op">=</span> <span class="va">self</span>._enhance_context(context_docs)</span>
<span id="cb5-421"><a href="#cb5-421" aria-hidden="true"></a></span>
<span id="cb5-422"><a href="#cb5-422" aria-hidden="true"></a>                <span class="co"># Formatting the prompt and getting a response.</span></span>
<span id="cb5-423"><a href="#cb5-423" aria-hidden="true"></a>                messages <span class="op">=</span> prompt.format_messages(</span>
<span id="cb5-424"><a href="#cb5-424" aria-hidden="true"></a>                    context<span class="op">=</span>enhanced_context, question<span class="op">=</span>question)</span>
<span id="cb5-425"><a href="#cb5-425" aria-hidden="true"></a></span>
<span id="cb5-426"><a href="#cb5-426" aria-hidden="true"></a>                answer <span class="op">=</span> llm.invoke(messages)</span>
<span id="cb5-427"><a href="#cb5-427" aria-hidden="true"></a></span>
<span id="cb5-428"><a href="#cb5-428" aria-hidden="true"></a>                <span class="co"># Extracting the content from the response.</span></span>
<span id="cb5-429"><a href="#cb5-429" aria-hidden="true"></a>                <span class="cf">if</span> <span class="bu">hasattr</span>(answer, <span class="st">&#39;content&#39;</span>):</span>
<span id="cb5-430"><a href="#cb5-430" aria-hidden="true"></a>                    answer_text <span class="op">=</span> answer.content</span>
<span id="cb5-431"><a href="#cb5-431" aria-hidden="true"></a>                <span class="cf">elif</span> <span class="bu">isinstance</span>(answer, <span class="bu">str</span>):</span>
<span id="cb5-432"><a href="#cb5-432" aria-hidden="true"></a>                    answer_text <span class="op">=</span> answer</span>
<span id="cb5-433"><a href="#cb5-433" aria-hidden="true"></a>                <span class="cf">else</span>:</span>
<span id="cb5-434"><a href="#cb5-434" aria-hidden="true"></a>                    answer_text <span class="op">=</span> <span class="bu">str</span>(answer)</span>
<span id="cb5-435"><a href="#cb5-435" aria-hidden="true"></a></span>
<span id="cb5-436"><a href="#cb5-436" aria-hidden="true"></a>                result <span class="op">=</span> {</span>
<span id="cb5-437"><a href="#cb5-437" aria-hidden="true"></a>                    <span class="st">&#39;context&#39;</span>: context_docs,</span>
<span id="cb5-438"><a href="#cb5-438" aria-hidden="true"></a>                    <span class="st">&#39;answer&#39;</span>: answer_text,</span>
<span id="cb5-439"><a href="#cb5-439" aria-hidden="true"></a>                    <span class="st">&#39;question&#39;</span>: question</span>
<span id="cb5-440"><a href="#cb5-440" aria-hidden="true"></a>                }</span>
<span id="cb5-441"><a href="#cb5-441" aria-hidden="true"></a></span>
<span id="cb5-442"><a href="#cb5-442" aria-hidden="true"></a>                <span class="cf">return</span> result</span>
<span id="cb5-443"><a href="#cb5-443" aria-hidden="true"></a></span>
<span id="cb5-444"><a href="#cb5-444" aria-hidden="true"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-445"><a href="#cb5-445" aria-hidden="true"></a>                <span class="cf">return</span> {</span>
<span id="cb5-446"><a href="#cb5-446" aria-hidden="true"></a>                    <span class="st">&#39;context&#39;</span>: [],</span>
<span id="cb5-447"><a href="#cb5-447" aria-hidden="true"></a>                    <span class="st">&#39;answer&#39;</span>: <span class="ss">f&quot;Error processing your question: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb5-448"><a href="#cb5-448" aria-hidden="true"></a>                    <span class="st">&#39;question&#39;</span>: question</span>
<span id="cb5-449"><a href="#cb5-449" aria-hidden="true"></a>                }</span>
<span id="cb5-450"><a href="#cb5-450" aria-hidden="true"></a></span>
<span id="cb5-451"><a href="#cb5-451" aria-hidden="true"></a>        <span class="va">self</span>.rag_chain <span class="op">=</span> rag_chain</span>
<span id="cb5-452"><a href="#cb5-452" aria-hidden="true"></a></span>
<span id="cb5-453"><a href="#cb5-453" aria-hidden="true"></a>        logger.info(</span>
<span id="cb5-454"><a href="#cb5-454" aria-hidden="true"></a>            <span class="st">&quot;RAG chain setup complete with custom prompt and improved context.&quot;</span>)</span>
<span id="cb5-455"><a href="#cb5-455" aria-hidden="true"></a></span>
<span id="cb5-456"><a href="#cb5-456" aria-hidden="true"></a></span>
<span id="cb5-457"><a href="#cb5-457" aria-hidden="true"></a>    <span class="kw">def</span> query(<span class="va">self</span>, question: <span class="bu">str</span>) <span class="op">-&gt;</span> Dict:</span>
<span id="cb5-458"><a href="#cb5-458" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.rag_chain:</span>
<span id="cb5-459"><a href="#cb5-459" aria-hidden="true"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(</span>
<span id="cb5-460"><a href="#cb5-460" aria-hidden="true"></a>                <span class="st">&quot;RAG chain not set up.&quot;</span>)</span>
<span id="cb5-461"><a href="#cb5-461" aria-hidden="true"></a></span>
<span id="cb5-462"><a href="#cb5-462" aria-hidden="true"></a>        <span class="cf">try</span>:</span>
<span id="cb5-463"><a href="#cb5-463" aria-hidden="true"></a>            logger.info(<span class="ss">f&quot;Processing query: </span><span class="sc">{</span>question[:<span class="dv">50</span>]<span class="sc">}</span><span class="ss">.&quot;</span>)</span>
<span id="cb5-464"><a href="#cb5-464" aria-hidden="true"></a></span>
<span id="cb5-465"><a href="#cb5-465" aria-hidden="true"></a>            result <span class="op">=</span> <span class="va">self</span>.rag_chain(question)</span>
<span id="cb5-466"><a href="#cb5-466" aria-hidden="true"></a></span>
<span id="cb5-467"><a href="#cb5-467" aria-hidden="true"></a>            <span class="co"># Checking the result has the expected structure.</span></span>
<span id="cb5-468"><a href="#cb5-468" aria-hidden="true"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(result, <span class="bu">dict</span>) <span class="kw">or</span> <span class="st">&#39;context&#39;</span> <span class="kw">not</span> <span class="kw">in</span> result <span class="kw">or</span> <span class="st">&#39;answer&#39;</span> <span class="kw">not</span> <span class="kw">in</span> result:</span>
<span id="cb5-469"><a href="#cb5-469" aria-hidden="true"></a>                <span class="cf">return</span> {</span>
<span id="cb5-470"><a href="#cb5-470" aria-hidden="true"></a>                    <span class="st">&#39;answer&#39;</span>: <span class="ss">f&quot;Error: Unexpected result structure from RAG chain. Got </span><span class="sc">{</span><span class="bu">type</span>(result)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb5-471"><a href="#cb5-471" aria-hidden="true"></a>                    <span class="st">&#39;sources&#39;</span>: [],</span>
<span id="cb5-472"><a href="#cb5-472" aria-hidden="true"></a>                    <span class="st">&#39;question&#39;</span>: question,</span>
<span id="cb5-473"><a href="#cb5-473" aria-hidden="true"></a>                    <span class="st">&#39;context_chunks&#39;</span>: <span class="dv">0</span>,</span>
<span id="cb5-474"><a href="#cb5-474" aria-hidden="true"></a>                    <span class="st">&#39;total_context_length&#39;</span>: <span class="dv">0</span></span>
<span id="cb5-475"><a href="#cb5-475" aria-hidden="true"></a>                }</span>
<span id="cb5-476"><a href="#cb5-476" aria-hidden="true"></a></span>
<span id="cb5-477"><a href="#cb5-477" aria-hidden="true"></a>            context_docs <span class="op">=</span> result[<span class="st">&#39;context&#39;</span>]</span>
<span id="cb5-478"><a href="#cb5-478" aria-hidden="true"></a></span>
<span id="cb5-479"><a href="#cb5-479" aria-hidden="true"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(context_docs, <span class="bu">list</span>):</span>
<span id="cb5-480"><a href="#cb5-480" aria-hidden="true"></a>                context_docs <span class="op">=</span> <span class="bu">list</span>(context_docs) <span class="cf">if</span> <span class="bu">hasattr</span>(</span>
<span id="cb5-481"><a href="#cb5-481" aria-hidden="true"></a>                    context_docs, <span class="st">&#39;__iter__&#39;</span>) <span class="cf">else</span> []</span>
<span id="cb5-482"><a href="#cb5-482" aria-hidden="true"></a></span>
<span id="cb5-483"><a href="#cb5-483" aria-hidden="true"></a>            <span class="co"># Formatting sources with more detail and ranking by relevance.</span></span>
<span id="cb5-484"><a href="#cb5-484" aria-hidden="true"></a>            sources <span class="op">=</span> []</span>
<span id="cb5-485"><a href="#cb5-485" aria-hidden="true"></a>            <span class="cf">for</span> i, doc <span class="kw">in</span> <span class="bu">enumerate</span>(context_docs):</span>
<span id="cb5-486"><a href="#cb5-486" aria-hidden="true"></a>                <span class="cf">try</span>:</span>
<span id="cb5-487"><a href="#cb5-487" aria-hidden="true"></a>                    source_name <span class="op">=</span> doc.metadata.get(<span class="st">&#39;source&#39;</span>, <span class="st">&#39;Unknown&#39;</span>)</span>
<span id="cb5-488"><a href="#cb5-488" aria-hidden="true"></a>                    page <span class="op">=</span> doc.metadata.get(<span class="st">&#39;page&#39;</span>, <span class="st">&#39;Unknown&#39;</span>)</span>
<span id="cb5-489"><a href="#cb5-489" aria-hidden="true"></a></span>
<span id="cb5-490"><a href="#cb5-490" aria-hidden="true"></a>                    <span class="co"># Calculating the relevance score based on chunk length and content quality.</span></span>
<span id="cb5-491"><a href="#cb5-491" aria-hidden="true"></a>                    relevance_score <span class="op">=</span> <span class="bu">len</span>(doc.page_content) <span class="op">/</span> <span class="dv">1000</span></span>
<span id="cb5-492"><a href="#cb5-492" aria-hidden="true"></a></span>
<span id="cb5-493"><a href="#cb5-493" aria-hidden="true"></a>                    sources.append({</span>
<span id="cb5-494"><a href="#cb5-494" aria-hidden="true"></a>                        <span class="st">&#39;index&#39;</span>: i <span class="op">+</span> <span class="dv">1</span>,</span>
<span id="cb5-495"><a href="#cb5-495" aria-hidden="true"></a>                        <span class="st">&#39;source&#39;</span>: source_name,</span>
<span id="cb5-496"><a href="#cb5-496" aria-hidden="true"></a>                        <span class="st">&#39;page&#39;</span>: page,</span>
<span id="cb5-497"><a href="#cb5-497" aria-hidden="true"></a>                        <span class="st">&#39;chunk_length&#39;</span>: <span class="bu">len</span>(doc.page_content),</span>
<span id="cb5-498"><a href="#cb5-498" aria-hidden="true"></a>                        <span class="st">&#39;relevance_score&#39;</span>: <span class="bu">round</span>(relevance_score, <span class="dv">2</span>)</span>
<span id="cb5-499"><a href="#cb5-499" aria-hidden="true"></a>                    })</span>
<span id="cb5-500"><a href="#cb5-500" aria-hidden="true"></a>                <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-501"><a href="#cb5-501" aria-hidden="true"></a>                    <span class="cf">continue</span></span>
<span id="cb5-502"><a href="#cb5-502" aria-hidden="true"></a></span>
<span id="cb5-503"><a href="#cb5-503" aria-hidden="true"></a>            <span class="co"># Sorting sources by relevance score.</span></span>
<span id="cb5-504"><a href="#cb5-504" aria-hidden="true"></a>            sources.sort(key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">&#39;relevance_score&#39;</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-505"><a href="#cb5-505" aria-hidden="true"></a></span>
<span id="cb5-506"><a href="#cb5-506" aria-hidden="true"></a>            <span class="cf">return</span> {</span>
<span id="cb5-507"><a href="#cb5-507" aria-hidden="true"></a>                <span class="st">&#39;answer&#39;</span>: result[<span class="st">&#39;answer&#39;</span>],</span>
<span id="cb5-508"><a href="#cb5-508" aria-hidden="true"></a>                <span class="st">&#39;sources&#39;</span>: sources,</span>
<span id="cb5-509"><a href="#cb5-509" aria-hidden="true"></a>                <span class="st">&#39;question&#39;</span>: question,</span>
<span id="cb5-510"><a href="#cb5-510" aria-hidden="true"></a>                <span class="st">&#39;context_chunks&#39;</span>: <span class="bu">len</span>(context_docs),</span>
<span id="cb5-511"><a href="#cb5-511" aria-hidden="true"></a>                <span class="st">&#39;total_context_length&#39;</span>: <span class="bu">sum</span>(<span class="bu">len</span>(doc.page_content) <span class="cf">for</span> doc <span class="kw">in</span> context_docs <span class="cf">if</span> <span class="bu">hasattr</span>(doc, <span class="st">&#39;page_content&#39;</span>))</span>
<span id="cb5-512"><a href="#cb5-512" aria-hidden="true"></a>            }</span>
<span id="cb5-513"><a href="#cb5-513" aria-hidden="true"></a></span>
<span id="cb5-514"><a href="#cb5-514" aria-hidden="true"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-515"><a href="#cb5-515" aria-hidden="true"></a>            <span class="cf">return</span> {</span>
<span id="cb5-516"><a href="#cb5-516" aria-hidden="true"></a>                <span class="st">&#39;answer&#39;</span>: <span class="ss">f&quot;Error processing your question: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>,</span>
<span id="cb5-517"><a href="#cb5-517" aria-hidden="true"></a>                <span class="st">&#39;sources&#39;</span>: [],</span>
<span id="cb5-518"><a href="#cb5-518" aria-hidden="true"></a>                <span class="st">&#39;question&#39;</span>: question,</span>
<span id="cb5-519"><a href="#cb5-519" aria-hidden="true"></a>                <span class="st">&#39;context_chunks&#39;</span>: <span class="dv">0</span>,</span>
<span id="cb5-520"><a href="#cb5-520" aria-hidden="true"></a>                <span class="st">&#39;total_context_length&#39;</span>: <span class="dv">0</span></span>
<span id="cb5-521"><a href="#cb5-521" aria-hidden="true"></a>            }</span>
<span id="cb5-522"><a href="#cb5-522" aria-hidden="true"></a></span>
<span id="cb5-523"><a href="#cb5-523" aria-hidden="true"></a></span>
<span id="cb5-524"><a href="#cb5-524" aria-hidden="true"></a>    <span class="kw">def</span> run_test_all_questions(<span class="va">self</span>):</span>
<span id="cb5-525"><a href="#cb5-525" aria-hidden="true"></a></span>
<span id="cb5-526"><a href="#cb5-526" aria-hidden="true"></a>        Question_Tests <span class="op">=</span> [</span>
<span id="cb5-527"><a href="#cb5-527" aria-hidden="true"></a>                <span class="st">&quot;1. What is the primary goal of the SELF-ROUTE method proposed by Zhuowan Li?&quot;</span>,</span>
<span id="cb5-528"><a href="#cb5-528" aria-hidden="true"></a>                <span class="st">&quot;2. Explain why the researchers believe RAG might still be useful despite the superior performance of long-context LLMs.&quot;</span>,</span>
<span id="cb5-529"><a href="#cb5-529" aria-hidden="true"></a>                <span class="st">&quot;3. Compare the reranking techniques mentioned in the Wang paper. How do they impact the retrieval quality?&quot;</span>,</span>
<span id="cb5-530"><a href="#cb5-530" aria-hidden="true"></a>                <span class="st">&quot;4. What are the trade-offs involved when using different chunking strategies in RAG systems?&quot;</span>,</span>
<span id="cb5-531"><a href="#cb5-531" aria-hidden="true"></a>                <span class="st">&quot;5. How does multimodal retrieval enhance the capabilities of RAG?&quot;</span>,</span>
<span id="cb5-532"><a href="#cb5-532" aria-hidden="true"></a>                <span class="st">&quot;6. What were the key failure cases for RAG in handling long context retrievals, as noted by Zhuowan Li?&quot;</span>,</span>
<span id="cb5-533"><a href="#cb5-533" aria-hidden="true"></a>                <span class="st">&quot;7. Why does the Zhuowan paper claim that long-context LLMs outperformed RAG in most cases? What benefits does RAG still offer?&quot;</span>,</span>
<span id="cb5-534"><a href="#cb5-534" aria-hidden="true"></a>                <span class="st">&quot;8. Describe the metrics used to evaluate the different embedding models for RAG in Wang&#39;s paper.&quot;</span>,</span>
<span id="cb5-535"><a href="#cb5-535" aria-hidden="true"></a>                <span class="st">&quot;9. Discuss the implications of using self-reflection in routing queries between RAG and long-context LLMs.&quot;</span>,</span>
<span id="cb5-536"><a href="#cb5-536" aria-hidden="true"></a>                <span class="st">&quot;10. How does query rewriting contribute to the overall efficiency of RAG according to Wang&#39;s findings?&quot;</span></span>
<span id="cb5-537"><a href="#cb5-537" aria-hidden="true"></a>            ]</span>
<span id="cb5-538"><a href="#cb5-538" aria-hidden="true"></a></span>
<span id="cb5-539"><a href="#cb5-539" aria-hidden="true"></a>        <span class="cf">for</span> question <span class="kw">in</span> Question_Tests:</span>
<span id="cb5-540"><a href="#cb5-540" aria-hidden="true"></a>            result <span class="op">=</span> <span class="va">self</span>.query(question)</span>
<span id="cb5-541"><a href="#cb5-541" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Processing Question... </span><span class="sc">{</span>question<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-542"><a href="#cb5-542" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Answer: </span><span class="sc">{</span>result[<span class="st">&#39;answer&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-543"><a href="#cb5-543" aria-hidden="true"></a></span>
<span id="cb5-544"><a href="#cb5-544" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Sources: </span><span class="sc">{</span>result[<span class="st">&#39;sources&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-545"><a href="#cb5-545" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Context Chunks: </span><span class="sc">{</span>result[<span class="st">&#39;context_chunks&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-546"><a href="#cb5-546" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Total Context Length: </span><span class="sc">{</span>result[<span class="st">&#39;total_context_length&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-547"><a href="#cb5-547" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;-&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb5-548"><a href="#cb5-548" aria-hidden="true"></a></span>
<span id="cb5-549"><a href="#cb5-549" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;All questions tested.&quot;</span>)</span>
<span id="cb5-550"><a href="#cb5-550" aria-hidden="true"></a></span>
<span id="cb5-551"><a href="#cb5-551" aria-hidden="true"></a><span class="co"># Asking questions.</span></span>
<span id="cb5-552"><a href="#cb5-552" aria-hidden="true"></a>    <span class="kw">def</span> interactive_query_mode(<span class="va">self</span>):</span>
<span id="cb5-553"><a href="#cb5-553" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;-&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb5-554"><a href="#cb5-554" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;Interactive RAG query mode.&quot;</span>)</span>
<span id="cb5-555"><a href="#cb5-555" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;-&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb5-556"><a href="#cb5-556" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;Type your questions (type &#39;quit&#39; to exit).&quot;</span>)</span>
<span id="cb5-557"><a href="#cb5-557" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb5-558"><a href="#cb5-558" aria-hidden="true"></a></span>
<span id="cb5-559"><a href="#cb5-559" aria-hidden="true"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb5-560"><a href="#cb5-560" aria-hidden="true"></a>            <span class="cf">try</span>:</span>
<span id="cb5-561"><a href="#cb5-561" aria-hidden="true"></a>                question <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Your question: &quot;</span>).strip()</span>
<span id="cb5-562"><a href="#cb5-562" aria-hidden="true"></a></span>
<span id="cb5-563"><a href="#cb5-563" aria-hidden="true"></a>                <span class="cf">if</span> question.lower() <span class="kw">in</span> [<span class="st">&#39;quit&#39;</span>, <span class="st">&#39;exit&#39;</span>, <span class="st">&#39;q&#39;</span>]:</span>
<span id="cb5-564"><a href="#cb5-564" aria-hidden="true"></a>                    <span class="bu">print</span>(<span class="st">&quot;Goodbye.&quot;</span>)</span>
<span id="cb5-565"><a href="#cb5-565" aria-hidden="true"></a>                    <span class="cf">break</span></span>
<span id="cb5-566"><a href="#cb5-566" aria-hidden="true"></a></span>
<span id="cb5-567"><a href="#cb5-567" aria-hidden="true"></a>                <span class="cf">if</span> <span class="kw">not</span> question:</span>
<span id="cb5-568"><a href="#cb5-568" aria-hidden="true"></a>                    <span class="bu">print</span>(<span class="st">&quot;Please enter a question.&quot;</span>)</span>
<span id="cb5-569"><a href="#cb5-569" aria-hidden="true"></a>                    <span class="cf">continue</span></span>
<span id="cb5-570"><a href="#cb5-570" aria-hidden="true"></a></span>
<span id="cb5-571"><a href="#cb5-571" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss"> Processing Query...&quot;</span>)</span>
<span id="cb5-572"><a href="#cb5-572" aria-hidden="true"></a>                result <span class="op">=</span> <span class="va">self</span>.query(question)</span>
<span id="cb5-573"><a href="#cb5-573" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Answer: </span><span class="sc">{</span>result[<span class="st">&#39;answer&#39;</span>]<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-574"><a href="#cb5-574" aria-hidden="true"></a></span>
<span id="cb5-575"><a href="#cb5-575" aria-hidden="true"></a></span>
<span id="cb5-576"><a href="#cb5-576" aria-hidden="true"></a>                <span class="cf">if</span> result[<span class="st">&#39;sources&#39;</span>]:</span>
<span id="cb5-577"><a href="#cb5-577" aria-hidden="true"></a>                    <span class="bu">print</span>(</span>
<span id="cb5-578"><a href="#cb5-578" aria-hidden="true"></a>                        <span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss"> Sources (</span><span class="sc">{</span>result[<span class="st">&#39;context_chunks&#39;</span>]<span class="sc">}</span><span class="ss"> chunks used, </span><span class="sc">{</span>result[<span class="st">&#39;total_context_length&#39;</span>]<span class="sc">}</span><span class="ss"> total chars):&quot;</span>)</span>
<span id="cb5-579"><a href="#cb5-579" aria-hidden="true"></a>                    <span class="cf">for</span> source <span class="kw">in</span> result[<span class="st">&#39;sources&#39;</span>]:</span>
<span id="cb5-580"><a href="#cb5-580" aria-hidden="true"></a>                        <span class="bu">print</span>(</span>
<span id="cb5-581"><a href="#cb5-581" aria-hidden="true"></a>                            <span class="ss">f&quot;  [</span><span class="sc">{</span>source[<span class="st">&#39;index&#39;</span>]<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span>source[<span class="st">&#39;source&#39;</span>]<span class="sc">}</span><span class="ss">, Page </span><span class="sc">{</span>source[<span class="st">&#39;page&#39;</span>]<span class="sc">}</span><span class="ss"> (Score: </span><span class="sc">{</span>source[<span class="st">&#39;relevance_score&#39;</span>]<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>source[<span class="st">&#39;chunk_length&#39;</span>]<span class="sc">}</span><span class="ss"> chars)&quot;</span>)</span>
<span id="cb5-582"><a href="#cb5-582" aria-hidden="true"></a>                <span class="cf">else</span>:</span>
<span id="cb5-583"><a href="#cb5-583" aria-hidden="true"></a>                    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> No sources found.&quot;</span>)</span>
<span id="cb5-584"><a href="#cb5-584" aria-hidden="true"></a></span>
<span id="cb5-585"><a href="#cb5-585" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="st">&quot;-&quot;</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb5-586"><a href="#cb5-586" aria-hidden="true"></a></span>
<span id="cb5-587"><a href="#cb5-587" aria-hidden="true"></a>            <span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb5-588"><a href="#cb5-588" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Goodbye.&quot;</span>)</span>
<span id="cb5-589"><a href="#cb5-589" aria-hidden="true"></a>                <span class="cf">break</span></span>
<span id="cb5-590"><a href="#cb5-590" aria-hidden="true"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-591"><a href="#cb5-591" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Error: </span><span class="sc">{e}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-592"><a href="#cb5-592" aria-hidden="true"></a></span>
<span id="cb5-593"><a href="#cb5-593" aria-hidden="true"></a></span>
<span id="cb5-594"><a href="#cb5-594" aria-hidden="true"></a>    <span class="at">@staticmethod</span></span>
<span id="cb5-595"><a href="#cb5-595" aria-hidden="true"></a>    <span class="kw">def</span> setup_rag_system():</span>
<span id="cb5-596"><a href="#cb5-596" aria-hidden="true"></a></span>
<span id="cb5-597"><a href="#cb5-597" aria-hidden="true"></a>        load_dotenv()</span>
<span id="cb5-598"><a href="#cb5-598" aria-hidden="true"></a></span>
<span id="cb5-599"><a href="#cb5-599" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> AcademicRAG.get_api_key_for_provider(DEFAULT_MODEL_PROVIDER):</span>
<span id="cb5-600"><a href="#cb5-600" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb5-601"><a href="#cb5-601" aria-hidden="true"></a></span>
<span id="cb5-602"><a href="#cb5-602" aria-hidden="true"></a>        rag_system <span class="op">=</span> AcademicRAG(</span>
<span id="cb5-603"><a href="#cb5-603" aria-hidden="true"></a>            model_provider<span class="op">=</span>DEFAULT_MODEL_PROVIDER,</span>
<span id="cb5-604"><a href="#cb5-604" aria-hidden="true"></a>            model_name<span class="op">=</span>DEFAULT_MODEL_NAME,</span>
<span id="cb5-605"><a href="#cb5-605" aria-hidden="true"></a>            temperature<span class="op">=</span>DEFAULT_TEMPERATURE)</span>
<span id="cb5-606"><a href="#cb5-606" aria-hidden="true"></a></span>
<span id="cb5-607"><a href="#cb5-607" aria-hidden="true"></a>        AcademicRAG.rag_folder <span class="op">=</span> rag_system.setup_google_drive()</span>
<span id="cb5-608"><a href="#cb5-608" aria-hidden="true"></a></span>
<span id="cb5-609"><a href="#cb5-609" aria-hidden="true"></a>        <span class="cf">if</span> <span class="kw">not</span> AcademicRAG.rag_folder:</span>
<span id="cb5-610"><a href="#cb5-610" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> RAG folder not found.&quot;</span>)</span>
<span id="cb5-611"><a href="#cb5-611" aria-hidden="true"></a>            rag_system.list_available_folders()</span>
<span id="cb5-612"><a href="#cb5-612" aria-hidden="true"></a></span>
<span id="cb5-613"><a href="#cb5-613" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;-&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb5-614"><a href="#cb5-614" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;Manual setup.&quot;</span>)</span>
<span id="cb5-615"><a href="#cb5-615" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;-&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb5-616"><a href="#cb5-616" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;Please specify the path to your documents folder:&quot;</span>)</span>
<span id="cb5-617"><a href="#cb5-617" aria-hidden="true"></a></span>
<span id="cb5-618"><a href="#cb5-618" aria-hidden="true"></a>            <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb5-619"><a href="#cb5-619" aria-hidden="true"></a>                manual_path <span class="op">=</span> <span class="bu">input</span>(</span>
<span id="cb5-620"><a href="#cb5-620" aria-hidden="true"></a>                    <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Enter the path to your documents folder: &quot;</span>).strip()</span>
<span id="cb5-621"><a href="#cb5-621" aria-hidden="true"></a></span>
<span id="cb5-622"><a href="#cb5-622" aria-hidden="true"></a>                <span class="cf">if</span> <span class="kw">not</span> manual_path:</span>
<span id="cb5-623"><a href="#cb5-623" aria-hidden="true"></a>                    <span class="bu">print</span>(<span class="st">&quot;Please enter a valid path.&quot;</span>)</span>
<span id="cb5-624"><a href="#cb5-624" aria-hidden="true"></a>                    <span class="cf">continue</span></span>
<span id="cb5-625"><a href="#cb5-625" aria-hidden="true"></a></span>
<span id="cb5-626"><a href="#cb5-626" aria-hidden="true"></a>                <span class="cf">if</span> os.path.exists(manual_path):</span>
<span id="cb5-627"><a href="#cb5-627" aria-hidden="true"></a>                    AcademicRAG.rag_folder <span class="op">=</span> manual_path</span>
<span id="cb5-628"><a href="#cb5-628" aria-hidden="true"></a>                    <span class="cf">break</span></span>
<span id="cb5-629"><a href="#cb5-629" aria-hidden="true"></a>                <span class="cf">else</span>:</span>
<span id="cb5-630"><a href="#cb5-630" aria-hidden="true"></a>                    <span class="bu">print</span>(<span class="ss">f&quot;Path not found: </span><span class="sc">{</span>manual_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-631"><a href="#cb5-631" aria-hidden="true"></a>                    <span class="bu">print</span>(<span class="st">&quot;Please enter a valid path.&quot;</span>)</span>
<span id="cb5-632"><a href="#cb5-632" aria-hidden="true"></a></span>
<span id="cb5-633"><a href="#cb5-633" aria-hidden="true"></a>        <span class="cf">try</span>:</span>
<span id="cb5-634"><a href="#cb5-634" aria-hidden="true"></a>            <span class="co"># Loading the documents.</span></span>
<span id="cb5-635"><a href="#cb5-635" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss"> Loading documents from: </span><span class="sc">{</span>AcademicRAG<span class="sc">.</span>rag_folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-636"><a href="#cb5-636" aria-hidden="true"></a>            <span class="cf">try</span>:</span>
<span id="cb5-637"><a href="#cb5-637" aria-hidden="true"></a>                rag_system.load_documents(AcademicRAG.rag_folder)</span>
<span id="cb5-638"><a href="#cb5-638" aria-hidden="true"></a>                <span class="bu">print</span>(</span>
<span id="cb5-639"><a href="#cb5-639" aria-hidden="true"></a>                    <span class="ss">f&quot;Loaded </span><span class="sc">{</span><span class="bu">len</span>(rag_system.documents)<span class="sc">}</span><span class="ss"> documents.&quot;</span>)</span>
<span id="cb5-640"><a href="#cb5-640" aria-hidden="true"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> doc_error:</span>
<span id="cb5-641"><a href="#cb5-641" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Error loading documents: </span><span class="sc">{</span>doc_error<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-642"><a href="#cb5-642" aria-hidden="true"></a>                <span class="cf">raise</span></span>
<span id="cb5-643"><a href="#cb5-643" aria-hidden="true"></a></span>
<span id="cb5-644"><a href="#cb5-644" aria-hidden="true"></a>            <span class="co"># Vector store.</span></span>
<span id="cb5-645"><a href="#cb5-645" aria-hidden="true"></a>            <span class="cf">try</span>:</span>
<span id="cb5-646"><a href="#cb5-646" aria-hidden="true"></a>                rag_system.create_vector_store()</span>
<span id="cb5-647"><a href="#cb5-647" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="st">&quot;Vector store created.&quot;</span>)</span>
<span id="cb5-648"><a href="#cb5-648" aria-hidden="true"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> vs_error:</span>
<span id="cb5-649"><a href="#cb5-649" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Error creating vector store: </span><span class="sc">{</span>vs_error<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-650"><a href="#cb5-650" aria-hidden="true"></a>                <span class="cf">raise</span></span>
<span id="cb5-651"><a href="#cb5-651" aria-hidden="true"></a></span>
<span id="cb5-652"><a href="#cb5-652" aria-hidden="true"></a>            <span class="cf">try</span>:</span>
<span id="cb5-653"><a href="#cb5-653" aria-hidden="true"></a>                rag_system.setup_rag_chain()</span>
<span id="cb5-654"><a href="#cb5-654" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="st">&quot;RAG chain setup.&quot;</span>)</span>
<span id="cb5-655"><a href="#cb5-655" aria-hidden="true"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> chain_error:</span>
<span id="cb5-656"><a href="#cb5-656" aria-hidden="true"></a>                <span class="bu">print</span>(<span class="ss">f&quot;Error setting up RAG chain: </span><span class="sc">{</span>chain_error<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-657"><a href="#cb5-657" aria-hidden="true"></a>                <span class="cf">raise</span></span>
<span id="cb5-658"><a href="#cb5-658" aria-hidden="true"></a></span>
<span id="cb5-659"><a href="#cb5-659" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> RAG system ready.&quot;</span>)</span>
<span id="cb5-660"><a href="#cb5-660" aria-hidden="true"></a>            <span class="cf">return</span> rag_system</span>
<span id="cb5-661"><a href="#cb5-661" aria-hidden="true"></a></span>
<span id="cb5-662"><a href="#cb5-662" aria-hidden="true"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-663"><a href="#cb5-663" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="ss">f&quot;ERROR: </span><span class="sc">{e}</span><span class="ss">&quot;</span>)</span>
<span id="cb5-664"><a href="#cb5-664" aria-hidden="true"></a>            <span class="cf">return</span> <span class="va">None</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">def</span> main():</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;RAG System for Academic Papers&quot;</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;-&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>    rag_system <span class="op">=</span> AcademicRAG.setup_rag_system()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>    <span class="cf">if</span> <span class="kw">not</span> rag_system:</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;Failed to setup RAG system.&quot;</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>        <span class="cf">return</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>    fine_tuned_path <span class="op">=</span> <span class="st">&quot;/content/drive/MyDrive/fine_tuned_model_ragqa&quot;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>    <span class="cf">if</span> os.path.exists(fine_tuned_path):</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss"> Fine-tuned model found at: </span><span class="sc">{</span>fine_tuned_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;Would you like to use the fine-tuned model for better performance? (y/n): &quot;</span>, end<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a>        use_fine_tuned <span class="op">=</span> <span class="bu">input</span>().strip().lower() <span class="op">==</span> <span class="st">&#39;y&#39;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a>        <span class="cf">if</span> use_fine_tuned:</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;Using fine-tuned embeddings for improved retrieval.&quot;</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a>        <span class="cf">else</span>:</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;Using standard embeddings.&quot;</span>)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a>    <span class="cf">else</span>:</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss"> No fine-tuned model found at: </span><span class="sc">{</span>fine_tuned_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;To create a fine-tuned model, run finetuned.py.&quot;</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a>    <span class="co"># Ask user what they want to do</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;-&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;Select Mode:&quot;</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;1. Interactive Query Mode.&quot;</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;2. Run Test For All Questions.&quot;</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;3. Compare the Fine-tuned vs Baseline.&quot;</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;4. Exit&quot;</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="st">&quot;-&quot;</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true"></a>    choice <span class="op">=</span> <span class="bu">input</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Enter your choice (1-4): &quot;</span>).strip()</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true"></a>    <span class="cf">if</span> choice <span class="op">==</span> <span class="st">&quot;1&quot;</span>:</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true"></a>        rag_system.interactive_query_mode()</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true"></a>    <span class="cf">elif</span> choice <span class="op">==</span> <span class="st">&quot;2&quot;</span>:</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true"></a>        rag_system.run_test_all_questions()</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true"></a>    <span class="cf">elif</span> choice <span class="op">==</span> <span class="st">&quot;3&quot;</span>:</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true"></a>        <span class="cf">if</span> os.path.exists(fine_tuned_path):</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> Running performance comparison.&quot;</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true"></a>            rag_system.compare_fine_tuned_vs_baseline()</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true"></a>        <span class="cf">else</span>:</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;X No fine-tuned model available for comparison.&quot;</span>)</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true"></a>            <span class="bu">print</span>(<span class="st">&quot;Run finetuned.py to create one.&quot;</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true"></a>    <span class="cf">elif</span> choice <span class="op">==</span> <span class="st">&quot;4&quot;</span>:</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;Goodbye.&quot;</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true"></a>    <span class="cf">else</span>:</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true"></a>        <span class="bu">print</span>(<span class="st">&quot;Invalid choice.&quot;</span>)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true"></a>        rag_system.interactive_query_mode()</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>    main()</span></code></pre></div>
<pre><code>RAG System for Academic Papers
------------------------------------------------------------
Enter your Google API key: ··········
Google_Genai API key set in environment (length: 39)
Mounted at /content/drive
Found RAG folder at: /content/drive/MyDrive/RAG

 Loading documents from: /content/drive/MyDrive/RAG
Loaded 34 documents.
Using standard embeddings.


/tmp/ipython-input-3556706580.py:286: LangChainDeprecationWarning: The class `HuggingFaceEmbeddings` was deprecated in LangChain 0.2.2 and will be removed in 1.0. An updated version of the class exists in the :class:`~langchain-huggingface package and should be used instead. To use it run `pip install -U :class:`~langchain-huggingface` and import as `from :class:`~langchain_huggingface import HuggingFaceEmbeddings``.
  return HuggingFaceEmbeddings(model_name=&quot;sentence-transformers/all-MiniLM-L6-v2&quot;)
/usr/local/lib/python3.12/dist-packages/huggingface_hub/utils/_auth.py:94: UserWarning: 
The secret `HF_TOKEN` does not exist in your Colab secrets.
To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.
You will be able to reuse this secret in all of your notebooks.
Please note that authentication is recommended but still optional to access public models or datasets.
  warnings.warn(



modules.json:   0%|          | 0.00/349 [00:00&lt;?, ?B/s]



config_sentence_transformers.json:   0%|          | 0.00/116 [00:00&lt;?, ?B/s]



README.md: 0.00B [00:00, ?B/s]



sentence_bert_config.json:   0%|          | 0.00/53.0 [00:00&lt;?, ?B/s]



config.json:   0%|          | 0.00/612 [00:00&lt;?, ?B/s]



model.safetensors:   0%|          | 0.00/90.9M [00:00&lt;?, ?B/s]



tokenizer_config.json:   0%|          | 0.00/350 [00:00&lt;?, ?B/s]



vocab.txt: 0.00B [00:00, ?B/s]



tokenizer.json: 0.00B [00:00, ?B/s]



special_tokens_map.json:   0%|          | 0.00/112 [00:00&lt;?, ?B/s]



config.json:   0%|          | 0.00/190 [00:00&lt;?, ?B/s]


Created 86 text chunks
Vector store created.
Vector store created.
RAG chain setup.

 RAG system ready.

 Fine-tuned model found at: /content/drive/MyDrive/fine_tuned_model_ragqa
Would you like to use the fine-tuned model for better performance? (y/n): y
Using fine-tuned embeddings for improved retrieval.

------------------------------------------------------------
Select Mode:
1. Interactive Query Mode.
2. Run Test For All Questions.
3. Compare the Fine-tuned vs Baseline.
4. Exit
------------------------------------------------------------

 Enter your choice (1-4): 2


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Processing Question... 1. What is the primary goal of the SELF-ROUTE method proposed by Zhuowan Li?
Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]
Sources: []
Context Chunks: 0
Total Context Length: 0
------------------------------------------------------------


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Processing Question... 2. Explain why the researchers believe RAG might still be useful despite the superior performance of long-context LLMs.
Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]
Sources: []
Context Chunks: 0
Total Context Length: 0
------------------------------------------------------------


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Processing Question... 3. Compare the reranking techniques mentioned in the Wang paper. How do they impact the retrieval quality?
Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]
Sources: []
Context Chunks: 0
Total Context Length: 0
------------------------------------------------------------


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Processing Question... 4. What are the trade-offs involved when using different chunking strategies in RAG systems?
Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]
Sources: []
Context Chunks: 0
Total Context Length: 0
------------------------------------------------------------


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Processing Question... 5. How does multimodal retrieval enhance the capabilities of RAG?
Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]
Sources: []
Context Chunks: 0
Total Context Length: 0
------------------------------------------------------------


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Processing Question... 6. What were the key failure cases for RAG in handling long context retrievals, as noted by Zhuowan Li?
Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]
Sources: []
Context Chunks: 0
Total Context Length: 0
------------------------------------------------------------


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Processing Question... 7. Why does the Zhuowan paper claim that long-context LLMs outperformed RAG in most cases? What benefits does RAG still offer?
Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]
Sources: []
Context Chunks: 0
Total Context Length: 0
------------------------------------------------------------


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Processing Question... 8. Describe the metrics used to evaluate the different embedding models for RAG in Wang&#39;s paper.
Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]
Sources: []
Context Chunks: 0
Total Context Length: 0
------------------------------------------------------------


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Processing Question... 9. Discuss the implications of using self-reflection in routing queries between RAG and long-context LLMs.
Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]
Sources: []
Context Chunks: 0
Total Context Length: 0
------------------------------------------------------------


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Processing Question... 10. How does query rewriting contribute to the overall efficiency of RAG according to Wang&#39;s findings?
Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]
Sources: []
Context Chunks: 0
Total Context Length: 0
------------------------------------------------------------
All questions tested.</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>main()</span></code></pre></div>
<pre><code>RAG System for Academic Papers
------------------------------------------------------------
Google_Genai API key set in environment (length: 39)
Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&quot;/content/drive&quot;, force_remount=True).
Found RAG folder at: /content/drive/MyDrive/RAG

 Loading documents from: /content/drive/MyDrive/RAG
Loaded 34 documents.
Using standard embeddings.
Created 86 text chunks
Vector store created.
Vector store created.
RAG chain setup.

 RAG system ready.

 Fine-tuned model found at: /content/drive/MyDrive/fine_tuned_model_ragqa
Would you like to use the fine-tuned model for better performance? (y/n): y
Using fine-tuned embeddings for improved retrieval.

------------------------------------------------------------
Select Mode:
1. Interactive Query Mode.
2. Run Test For All Questions.
3. Compare the Fine-tuned vs Baseline.
4. Exit
------------------------------------------------------------

 Enter your choice (1-4): 3

 Running performance comparison.
Fine-tuned vs Baseline
------------------------------------------------------------
Using standard embeddings.
Created 86 text chunks
Vector store created.
Using fine-tuned embeddings from: /content/drive/MyDrive/fine_tuned_model_ragqa
Created 86 text chunks
Vector store created.

 Evaluation Metrics for the Baseline vs Fine-tuned:
     Metric  Baseline  Fine-tuned  Change (%)
0  Recall@1     0.016       0.070         5.4
1     MRR@1     0.016       0.070         5.4
2  Recall@3     0.023       0.155        13.2
3     MRR@3     0.018       0.102         8.4
4  Recall@5     0.023       0.295        27.1
5     MRR@5     0.018       0.134        11.6</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>main()</span></code></pre></div>
<pre><code>RAG System for Academic Papers
------------------------------------------------------------
Google_Genai API key set in environment (length: 39)
Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&quot;/content/drive&quot;, force_remount=True).
Found RAG folder at: /content/drive/MyDrive/RAG

 Loading documents from: /content/drive/MyDrive/RAG
Loaded 34 documents.
Using standard embeddings.
Created 86 text chunks
Vector store created.
Vector store created.
RAG chain setup.

 RAG system ready.

 Fine-tuned model found at: /content/drive/MyDrive/fine_tuned_model_ragqa
Would you like to use the fine-tuned model for better performance? (y/n): y
Using fine-tuned embeddings for improved retrieval.

------------------------------------------------------------
Select Mode:
1. Interactive Query Mode.
2. Run Test For All Questions.
3. Compare the Fine-tuned vs Baseline.
4. Exit
------------------------------------------------------------

 Enter your choice (1-4): 1

------------------------------------------------------------
Interactive RAG query mode.
------------------------------------------------------------
Type your questions (type &#39;quit&#39; to exit).
------------------------------------------------------------

 Your question: What is the primary goal of the SELF-ROUTE method proposed by Zhuowan Li?

 Processing Query...


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]

 No sources found.
------------------------------------------------------------

 Your question: Explain why the researchers believe RAG might still be useful despite the superior performance of long-context LLMs


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 2.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].



 Processing Query...


WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 4.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 8.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 16.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].
WARNING:langchain_google_genai.chat_models:Retrying langchain_google_genai.chat_models._chat_with_retry.&lt;locals&gt;._chat_with_retry in 32.0 seconds as it raised PermissionDenied: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
].


Answer: Error processing your question: 403 Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry. [reason: &quot;SERVICE_DISABLED&quot;
domain: &quot;googleapis.com&quot;
metadata {
  key: &quot;service&quot;
  value: &quot;generativelanguage.googleapis.com&quot;
}
metadata {
  key: &quot;serviceTitle&quot;
  value: &quot;Generative Language API&quot;
}
metadata {
  key: &quot;containerInfo&quot;
  value: &quot;1012481686979&quot;
}
metadata {
  key: &quot;consumer&quot;
  value: &quot;projects/1012481686979&quot;
}
metadata {
  key: &quot;activationUrl&quot;
  value: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
, locale: &quot;en-US&quot;
message: &quot;Generative Language API has not been used in project 1012481686979 before or it is disabled. Enable it by visiting https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979 then retry. If you enabled this API recently, wait a few minutes for the action to propagate to our systems and retry.&quot;
, links {
  description: &quot;Google developers console API activation&quot;
  url: &quot;https://console.developers.google.com/apis/api/generativelanguage.googleapis.com/overview?project=1012481686979&quot;
}
]

 No sources found.
------------------------------------------------------------

 Your question: quit
Goodbye.</code></pre>
<p>Baseline: all-MiniLM-L6-v2. Fine-tuning on in-domain QA pairs with hard negatives improved early-rank retrieval (Recall@1 5.4%, Recall@5 22.5%.) compared to the first RAG under identical evaluation settings.</p>
<p>In Part 1 of the assignment, I implemented a RAG pipeline using all-MiniLM-L6-v2 as the baseline embedding model. I evaluated the system on academic articles and I measured retrieval performance using early-rank metrics.</p>
<p>I extended the work by fine-tuning a SentenceTransformer model on my in-domain QA pairs, including the use of hard negatives. The fine-tuned model was then integrated back into the same RAG setup so that the evaluation would be consistent with Part 1.</p>
<p>The fine-tuned embeddings improved retrieval quality over the baseline. For example, Recall@1 and MRR@1 improved by about 5.4%, Recall@3 increased by 11.6% and Recall@5 by 22.5%, with similar gains in MRR@3 with a increase of 7.9% and MRR@5 with an improvement of 10.3%. These improvements show that fine-tuning lead to stronger retrieval performance and better accuracy in the RAG pipeline.</p>
<p>So, in summary I built a baseline RAG system, fine-tuned an embedding model on QA pairs, used a baseline other than BGE and showed improvements compared to Part 1.</p>
